<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
    <id>HHH-1629</id>
    <title>SchemaUpdate/validator doesn't listen to quoting</title>
    <description>
        <paragraph id="1">
            <sentence id="1.1">The SchemaUpdate only generates SQL with CREATE TABLE statements and can't update existing tables.</sentence>
        </paragraph>
        <paragraph id="2">
            <sentence id="2.1">With debugging turned on the SchemaUpdate reports:
11:25:22,599 INFO SchemaUpdate:114 - Running hbm2ddl schema update
11:25:22,599 INFO SchemaUpdate:126 - fetching database metadata
.11:25:22,771 INFO SchemaUpdate:142 - updating schema
11:25:22,803 INFO DatabaseMetadata:91 - table not found: AffyFeatures
11:25:22,830 INFO DatabaseMetadata:91 - table not found: AnnotationSets
11:25:22,855 INFO DatabaseMetadata:91 - table not found: AnnotationTypeItems
.... and so on for another 100+ tables</sentence>
        </paragraph>
        <paragraph id="3">
            <sentence id="3.1">All tables except two exists in the database.</sentence>
            <sentence id="3.2">The two new tables are created successfully by SchemaUpdate.</sentence>
            <sentence id="3.3">I attach one of my mapping files (generated by XDoclet).</sentence>
        </paragraph>
        <paragraph id="4">
            <sentence id="4.1">I had a quick look at the SchemaUpdate code (which calls DatabaseMetadata) and I think the problem is that it converts the table names to upper or lower case, even though I have quoted them in the mapping files.</sentence>
            <sentence id="4.2">If the DatabaseMetadata.getTableMetadata could take a Table object as a parameter instead of the name, schema and catalog, it could check the Table.isQuoted() method before converting any names to upper or lower case.</sentence>
            <sentence id="4.3">It seems like this method is only used by the Configuration class so it shouldn't be too hard to fix.</sentence>
        </paragraph>
        <paragraph id="5">
            <sentence id="5.1">I could do the fix myself, but I will only be able to validate it against Postgres and MySQL using quoted table names.</sentence>
            <sentence id="5.2">So, others would probably have to validate it agains other databases and using unquoted table names.</sentence>
        </paragraph>
    </description>
</bug>
