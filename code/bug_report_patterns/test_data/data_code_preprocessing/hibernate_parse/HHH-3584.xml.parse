<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
    <id>HHH-3584</id>
    <title>Generate SQL when Dynamic Update is true is including version field even when marked as updateable=false</title>
    <description>
        <paragraph id="1">
            <sentence id="1.1">If an entity has the annotation:</sentence>
            <sentence id="1.2">@Enitity(dynamicUpdate=true)</sentence>
            <sentence id="1.3">And a field annotated as :</sentence>
            <sentence id="1.4">@Version
@Generated(GenerationTime.Always)
@Column(updateable=false, insertable=false)</sentence>
            <sentence id="1.5">The generated update sql will include the annotated field in the properties to be updated.</sentence>
            <sentence id="1.6">This is incorrect and causes exceptions in certain cases.</sentence>
            <sentence id="1.7">E.g updating a view where the resulting columns cross multiple tables.</sentence>
        </paragraph>
        <paragraph id="2">
            <sentence id="2.1">When the dynamicUpdate is set to true, the sql string is generated dynamically and initially the field marked as updateable=false is flagged as not to be included.</sentence>
            <sentence id="2.2">The AbstractEntityPersiter.getPropertiesToUpdate method then checks if there is a versioning field, finds the above annotated column and now flags it to be included, neglecting to check whether this versioning field has also been marked as updateable=false, or whether @Generated(GenerationTime.ALWAYS) is there.</sentence>
            <sentence id="2.3">(Although the last isn't really necessary as this annotation can't be there without the column being marked as not updateable and not insertable.)</sentence>
        </paragraph>
    </description>
</bug>
