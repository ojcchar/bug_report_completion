<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
    <id>40416</id>
    <title>mod_proxy_ftp cannot connect under http load in forward proxy</title>
    <description>
        <paragraph id="1">
            <sentence id="1.1">Using 2.2.3 on SUN/solaris and PC/suse-linux in a forward proxy configuration.</sentence>
            <sentence id="1.2">Without other http connections the ftp functionality is fine.</sentence>
            <sentence id="1.3">With other http
connections the ftp starts to fail increasingly under http request load until it
no longer functions.</sentence>
            <sentence id="1.4">This is easily reproduced using one http connection/sec
through the forward proxy.</sentence>
            <sentence id="1.5">Although proxy_util.</sentence>
            <sentence id="1.6">c(2141) says the connection is
complete there are no connection attempts from the proxy to the destination
server.</sentence>
            <sentence id="1.7">This was checked with snoop/tcpdump.</sentence>
            <sentence id="1.8">In the example below note the
hostname as www.gatesec.net for the ftp.suse.org address (195.135.221.132).</sentence>
        </paragraph>
        <paragraph id="2">
            <sentence id="2.1">Successful connections show this:
Sep  5 23:34:48 hereford fproxy1: [Tue Sep 05 23:34:48 2006] [debug]
mod_proxy_ftp.</sentence>
            <sentence id="2.2">c(894): proxy: FTP: connecting ftp://ftp.suse.com/ to ftp.suse.com:21
Sep  5 23:34:48 hereford fproxy1: [Tue Sep 05 23:34:48 2006] [debug]
proxy_util.</sentence>
            <sentence id="2.3">c(2141): proxy: FTP: connection complete to 195.135.221.132:21 ((null))</sentence>
        </paragraph>
        <paragraph id="3">
            <sentence id="3.1">Unsuccessful connections show this when using one connection/sec to</sentence>
            <sentence id="3.2">http://www.gatesec.net:</sentence>
            <sentence id="3.3">Sep  5 23:45:19 hereford fproxy1: [Tue Sep 05 23:45:19 2006] [debug]</sentence>
            <sentence id="3.4">mod_proxy_ftp.c(894): proxy: FTP: connecting ftp://ftp.suse.com/ to ftp.suse.com:21</sentence>
            <sentence id="3.5">Sep  5 23:45:19 hereford fproxy1: [Tue Sep 05 23:45:19 2006] [debug]</sentence>
            <sentence id="3.6">proxy_util.c(2141): proxy: FTP: connection complete to 195.135.221.132:21</sentence>
            <sentence id="3.7">(www.gatesec.net)</sentence>
            <sentence id="3.8">Sep  5 23:45:19 hereford fproxy1: [Tue Sep 05 23:45:19 2006] [debug]</sentence>
            <sentence id="3.9">mod_proxy_ftp.c(981): proxy: FTP: control connection complete</sentence>
            <sentence id="3.10">Sep  5 23:45:21 hereford fproxy1: [Tue Sep 05 23:45:21 2006] [debug]</sentence>
            <sentence id="3.11">mod_proxy_ftp.c(626): proxy:&lt;FTP: 4294967295 &lt;unable to read result&gt;</sentence>
            <sentence id="3.12">Sep  5 23:45:21 hereford fproxy1: [Tue Sep 05 23:45:21 2006] [debug]</sentence>
            <sentence id="3.13">proxy_util.c(1816): proxy: FTP: has released connection for (*)</sentence>
            <sentence id="3.14">Sep  5 23:45:21 hereford fproxy1: [Tue Sep 05 23:45:21 2006] [error] [client</sentence>
            <sentence id="3.15">127.0.0.1] proxy: Error reading from remote server returned by ftp://ftp.suse.com/</sentence>
            <sentence id="3.16">Sep  5 23:45:21 hereford fproxy1: 127.0.0.1 - - [05/Sep/2006:23:45:19 +1000]</sentence>
            <sentence id="3.17">"GET ftp://ftp.suse.com/ HTTP/1.1" 502 67 "-" "Mozilla/5.0 (X11; U; Linux i686;</sentence>
            <sentence id="3.18">en-US; rv:1.8.0.5) Gecko/20060719 Firefox/1.5.0.5"</sentence>
        </paragraph>
        <paragraph id="4">
            <sentence id="4.1">/opt/chroot/fproxy-2.2.3/bin/httpd -l
Compiled in modules:
  core.c
  mod_authn_file.</sentence>
            <sentence id="4.20">c
  worker.c
  http_core.</sentence>
            <sentence id="4.24">c</sentence>
        </paragraph>
    </description>
</bug>
