<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
    <id>25698</id>
    <title>Intermittent failure connecting to port</title>
    <description>
        <paragraph id="1">
            <sentence id="1.1">If I run a global nginx (or tomcat, doesn't matter) service in a swarm, exposing a port on each node (I am load balancing to my cluster and need the same port open everywhere)</sentence>
        </paragraph>
        <paragraph id="2">
            <sentence id="2.1">docker service create --name my-nginx --with-registry-auth --mode global -p 7011:7011 -p 7010:7010 my-nginx:0.3</sentence>
        </paragraph>
        <paragraph id="3">
            <sentence id="3.1">The service starts on every node fine.</sentence>
            <sentence id="3.2">(yay)</sentence>
        </paragraph>
        <paragraph id="4">
            <sentence id="4.1">On any node I try to connect to the port and sometimes it works
'# nc -zv localhost 7010
Connection to localhost 7010 port [tcp/http-alt] succeeded!'</sentence>
        </paragraph>
        <paragraph id="5">
            <sentence id="5.1">and sometimes it doesn't"</sentence>
        </paragraph>
        <paragraph id="7">
            <sentence id="7.1">If I curl, I get similar results, but sometimes it seems to timeout.</sentence>
        </paragraph>
        <paragraph id="14">
            <sentence id="14.1">**Additional environment details (AWS, VirtualBox, physical, etc.):**</sentence>
        </paragraph>
        <paragraph id="15">
            <sentence id="15.1">I am on AWS</sentence>
        </paragraph>
        <paragraph id="16">
            <sentence id="16.1">**Steps to reproduce the issue:**</sentence>
            <sentence id="16.2">1 Deploy global service opening port N</sentence>
            <sentence id="16.3">2 try to connect to port N on any box (it fails intermittently)</sentence>
            <sentence id="16.4">3</sentence>
        </paragraph>
        <paragraph id="17">
            <sentence id="17.1">**Describe the results you received:**</sentence>
        </paragraph>
        <paragraph id="19">
            <sentence id="19.1">**Describe the results you expected:**</sentence>
        </paragraph>
        <paragraph id="21">
            <sentence id="21.1">All the time</sentence>
        </paragraph>
        <paragraph id="22">
            <sentence id="22.1">**Additional information you deem important (e.g. issue happens only occasionally):**</sentence>
        </paragraph>
        <paragraph id="23">
            <sentence id="23.1">it happens every time I start a service, but intermittently.</sentence>
            <sentence id="23.2">Maybe 50% failures.</sentence>
        </paragraph>
    </description>
</bug>
