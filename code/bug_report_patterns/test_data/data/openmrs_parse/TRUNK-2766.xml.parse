<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
	<id>TRUNK-2766</id>
	<title>Cannot upgrade from 1.8 to 1.9</title>
	<description>
		<paragraph id="1">
			<sentence id="1.1">While trying to upgrade from 1.8 to 1.9, i got the exception below:</sentence>
		</paragraph>
		<paragraph id="2">
			<sentence id="2.1">{code}</sentence>
		</paragraph>
		<paragraph id="3">
			<sentence id="3.1">SEVERE 10/17/11 5:41 PM:liquibase: Change Set liquibase-update-to-latest.xml::20110301-1030f::wyclif failed. Error: liquibase.exception.CustomChangeException: Failed to insert one or more concept map types</sentence>
			<sentence id="3.2">liquibase.exception.UnexpectedLiquibaseException: liquibase.exception.CustomChangeException: Failed to insert one or more concept map types</sentence>
			<sentence id="3.3">	at liquibase.change.custom.CustomChangeWrapper.generateStatements(CustomChangeWrapper.java:115)</sentence>
			<sentence id="3.4">	at liquibase.database.AbstractDatabase.executeStatements(AbstractDatabase.java:996)</sentence>
			<sentence id="3.5">	at liquibase.changelog.ChangeSet.execute(ChangeSet.java:317)</sentence>
			<sentence id="3.6">	at liquibase.changelog.visitor.UpdateVisitor.visit(UpdateVisitor.java:27)</sentence>
			<sentence id="3.7">	at org.openmrs.util.DatabaseUpdater$1OpenmrsUpdateVisitor.visit(DatabaseUpdater.java:199)</sentence>
			<sentence id="3.8">	at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:58)</sentence>
			<sentence id="3.9">	at org.openmrs.util.DatabaseUpdater.executeChangelog(DatabaseUpdater.java:224)</sentence>
			<sentence id="3.10">	at org.openmrs.util.DatabaseUpdater.executeChangelog(DatabaseUpdater.java:164)</sentence>
			<sentence id="3.11">	at org.openmrs.util.DatabaseUpdater.executeChangelog(DatabaseUpdater.java:149)</sentence>
			<sentence id="3.12">	at org.openmrs.web.filter.update.UpdateFilter$UpdateFilterCompletion$1.run(UpdateFilter.java:577)</sentence>
			<sentence id="3.13">	at java.lang.Thread.run(Thread.java:680)</sentence>
			<sentence id="3.14">Caused by: liquibase.exception.CustomChangeException: Failed to insert one or more concept map types</sentence>
			<sentence id="3.15">	at org.openmrs.util.databasechange.AddConceptMapTypesChangeset.runBatchInsert(AddConceptMapTypesChangeset.java:169)</sentence>
			<sentence id="3.16">	at org.openmrs.util.databasechange.AddConceptMapTypesChangeset.execute(AddConceptMapTypesChangeset.java:72)</sentence>
			<sentence id="3.17">	at liquibase.change.custom.CustomChangeWrapper.generateStatements(CustomChangeWrapper.java:110)</sentence>
			<sentence id="3.18">	... 10 more</sentence>
			<sentence id="3.19">INFO 10/17/11 5:41 PM:liquibase: Successfully released change log lock</sentence>
			<sentence id="3.20">ERROR - UpdateFilter$UpdateFilterCompletion$1.run(595) |2011-10-17 17:41:34,407| Unable to update the database</sentence>
			<sentence id="3.21">org.openmrs.util.DatabaseUpdateException: There was an error while updating the database to the latest. file: liquibase-update-to-latest.xml. Error: Migration failed for change set liquibase-update-to-latest.xml::20110301-1030f::wyclif:</sentence>
			<sentence id="3.22"> Reason: liquibase.exception.UnexpectedLiquibaseException: liquibase.exception.CustomChangeException: Failed to insert one or more concept map types:</sentence>
			<sentence id="3.23"> Caused By: liquibase.exception.CustomChangeException: Failed to insert one or more concept map types:</sentence>
			<sentence id="3.24"> Caused By: Failed to insert one or more concept map types</sentence>
			<sentence id="3.25">	at org.openmrs.util.DatabaseUpdater.executeChangelog(DatabaseUpdater.java:152)</sentence>
			<sentence id="3.26">	at org.openmrs.web.filter.update.UpdateFilter$UpdateFilterCompletion$1.run(UpdateFilter.java:577)</sentence>
			<sentence id="3.27">	at java.lang.Thread.run(Thread.java:680)</sentence>
			<sentence id="3.28">Caused by: liquibase.exception.MigrationFailedException: Migration failed for change set liquibase-update-to-latest.xml::20110301-1030f::wyclif:</sentence>
			<sentence id="3.29"> Reason: liquibase.exception.UnexpectedLiquibaseException: liquibase.exception.CustomChangeException: Failed to insert one or more concept map types:</sentence>
			<sentence id="3.30"> Caused By: liquibase.exception.CustomChangeException: Failed to insert one or more concept map types:</sentence>
			<sentence id="3.31"> Caused By: Failed to insert one or more concept map types</sentence>
			<sentence id="3.32">	at liquibase.changelog.ChangeSet.execute(ChangeSet.java:347)</sentence>
			<sentence id="3.33">	at liquibase.changelog.visitor.UpdateVisitor.visit(UpdateVisitor.java:27)</sentence>
			<sentence id="3.34">	at org.openmrs.util.DatabaseUpdater$1OpenmrsUpdateVisitor.visit(DatabaseUpdater.java:199)</sentence>
			<sentence id="3.35">	at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:58)</sentence>
			<sentence id="3.36">	at org.openmrs.util.DatabaseUpdater.executeChangelog(DatabaseUpdater.java:224)</sentence>
			<sentence id="3.37">	at org.openmrs.util.DatabaseUpdater.executeChangelog(DatabaseUpdater.java:164)</sentence>
			<sentence id="3.38">	at org.openmrs.util.DatabaseUpdater.executeChangelog(DatabaseUpdater.java:149)</sentence>
			<sentence id="3.39">	... 2 more</sentence>
			<sentence id="3.40">Caused by: liquibase.exception.UnexpectedLiquibaseException: liquibase.exception.CustomChangeException: Failed to insert one or more concept map types</sentence>
			<sentence id="3.41">	at liquibase.change.custom.CustomChangeWrapper.generateStatements(CustomChangeWrapper.java:115)</sentence>
			<sentence id="3.42">	at liquibase.database.AbstractDatabase.executeStatements(AbstractDatabase.java:996)</sentence>
			<sentence id="3.43">	at liquibase.changelog.ChangeSet.execute(ChangeSet.java:317)</sentence>
			<sentence id="3.44">	... 8 more</sentence>
			<sentence id="3.45">Caused by: liquibase.exception.CustomChangeException: Failed to insert one or more concept map types</sentence>
			<sentence id="3.46">	at org.openmrs.util.databasechange.AddConceptMapTypesChangeset.runBatchInsert(AddConceptMapTypesChangeset.java:169)</sentence>
			<sentence id="3.47">	at org.openmrs.util.databasechange.AddConceptMapTypesChangeset.execute(AddConceptMapTypesChangeset.java:72)</sentence>
			<sentence id="3.48">	at liquibase.change.custom.CustomChangeWrapper.generateStatements(CustomChangeWrapper.java:110)</sentence>
			<sentence id="3.49">	... 10 more</sentence>
			<sentence id="3.50">INFO 10/17/11 5:41 PM:liquibase: Reading from `liquibasechangelog`</sentence>
			<sentence id="3.51">INFO 10/17/11 6:17 PM:liquibase: Reading from `liquibasechangelog`</sentence>
			<sentence id="3.52">INFO 10/17/11 6:17 PM:liquibase: Successfully acquired change log lock</sentence>
			<sentence id="3.53">INFO 10/17/11 6:17 PM:liquibase: Reading from `liquibasechangelog`</sentence>
			<sentence id="3.54">WARN - AddConceptMapTypesChangeset.runBatchInsert(147) |2011-10-17 18:17:52,305| Error generated while processsing batch insert</sentence>
			<sentence id="3.55">java.sql.BatchUpdateException: Unknown column 'is_hidden' in 'field list'</sentence>
			<sentence id="3.56">	at com.mysql.jdbc.PreparedStatement.executeBatchSerially(PreparedStatement.java:2016)</sentence>
			<sentence id="3.57">	at com.mysql.jdbc.PreparedStatement.executeBatch(PreparedStatement.java:1452)</sentence>
			<sentence id="3.58">	at org.openmrs.util.databasechange.AddConceptMapTypesChangeset.runBatchInsert(AddConceptMapTypesChangeset.java:132)</sentence>
			<sentence id="3.59">	at org.openmrs.util.databasechange.AddConceptMapTypesChangeset.execute(AddConceptMapTypesChangeset.java:72)</sentence>
			<sentence id="3.60">	at liquibase.change.custom.CustomChangeWrapper.generateStatements(CustomChangeWrapper.java:110)</sentence>
			<sentence id="3.61">	at liquibase.database.AbstractDatabase.executeStatements(AbstractDatabase.java:996)</sentence>
			<sentence id="3.62">	at liquibase.changelog.ChangeSet.execute(ChangeSet.java:317)</sentence>
			<sentence id="3.63">	at liquibase.changelog.visitor.UpdateVisitor.visit(UpdateVisitor.java:27)</sentence>
			<sentence id="3.64">	at org.openmrs.util.DatabaseUpdater$1OpenmrsUpdateVisitor.visit(DatabaseUpdater.java:199)</sentence>
			<sentence id="3.65">	at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:58)</sentence>
			<sentence id="3.66">	at org.openmrs.util.DatabaseUpdater.executeChangelog(DatabaseUpdater.java:224)</sentence>
			<sentence id="3.67">	at org.openmrs.util.DatabaseUpdater.executeChangelog(DatabaseUpdater.java:164)</sentence>
			<sentence id="3.68">	at org.openmrs.util.DatabaseUpdater.executeChangelog(DatabaseUpdater.java:149)</sentence>
			<sentence id="3.69">	at org.openmrs.web.filter.update.UpdateFilter$UpdateFilterCompletion$1.run(UpdateFilter.java:577)</sentence>
			<sentence id="3.70">	at java.lang.Thread.run(Thread.java:680)</sentence>
		</paragraph>
		<paragraph id="4">
			<sentence id="4.1">{code}</sentence>
		</paragraph>
		<paragraph id="5">
			<sentence id="5.1">Looks like this custom changeset is using the is_hidden column before the changeset which renames the badly named column from isHidden to is_hidden</sentence>
		</paragraph>
	</description>
</bug>
