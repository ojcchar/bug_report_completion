<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
	<id>20921</id>
	<title>Local volumes driver behaviour with a network mount and multiple docker engines</title>
	<description>
		<paragraph id="1">
			<sentence id="1.1">&lt;!</sentence>
			<sentence id="1.2">--
If you are reporting a new issue, make sure that we do not have any duplicates
already open.</sentence>
			<sentence id="1.3">You can ensure this by searching the issue list for this
repository.</sentence>
			<sentence id="1.4">If there is a duplicate, please close your issue and add a comment
to the existing issue instead.</sentence>
		</paragraph>
		<paragraph id="2">
			<sentence id="2.1">If you suspect your issue is a bug, please edit your issue description to
include the BUG REPORT INFORMATION shown below.</sentence>
			<sentence id="2.2">If you fail to provide this
information within 7 days, we cannot debug your issue and will close it.</sentence>
			<sentence id="2.3">We
will, however, reopen it if you later provide the information.</sentence>
		</paragraph>
		<paragraph id="3">
			<sentence id="3.1">For more information about reporting issues, see
https://github.com/docker/docker/blob/master/CONTRIBUTING.md#reporting-other-issues</sentence>
		</paragraph>
		<paragraph id="4">
			<sentence id="4.1">---------------------------------------------------</sentence>
			<sentence id="4.2">BUG REPORT INFORMATION</sentence>
			<sentence id="4.3">---------------------------------------------------</sentence>
			<sentence id="4.4">Use the commands below to provide key information from your environment:</sentence>
			<sentence id="4.5">You do NOT have to include this information if this is a FEATURE REQUEST</sentence>
			<sentence id="4.6">--&gt;</sentence>
		</paragraph>
		<paragraph id="5">
			<sentence id="5.1">Output of `docker version`:</sentence>
		</paragraph>
		<paragraph id="6">
			<sentence id="6.1">```
Client:
 Version: 1.10.2
 API version: 1.22
 Go version: go1.5.3
 Git commit: c3959b1
 Built: Mon Feb 22 21:37:01 2016
 OS/Arch: linux/amd64
 
Server:
 Version: 1.10.2
 API version: 1.22
 Go version: go1.5.3
 Git commit: c3959b1
 Built: Mon Feb 22 21:37:01 2016
 OS/Arch: linux/amd64
```</sentence>
		</paragraph>
		<paragraph id="7">
			<sentence id="7.1">Output of `docker info`:</sentence>
		</paragraph>
		<paragraph id="8">
			<sentence id="8.1">```
Containers: 4
 Running: 4
 Paused: 0
 Stopped: 0
Images: 189
Server Version: 1.10.2
Storage Driver: aufs
 Root Dir: /var/lib/docker/aufs
 Backing Filesystem: extfs
 Dirs: 230
 Dirperm1 Supported: true
Execution Driver: native-0.2
Logging Driver: json-file
Plugins: 
 Volume: local
 Network: bridge null host
Kernel Version: 3.16.0-46-generic
Operating System: Ubuntu 14.04.3 LTS
OSType: linux
Architecture: x86_64
CPUs: 4
Total Memory: 3.768 GiB
Name: minionA
ID: EBGI:3EZW:52OM:3OLW:3KRU:CLZF:NYMX:5HI4:PSJP:PHHE:KUGU:T4OE
WARNING: No swap limit support
Labels:
 dept=april
 geo=us
 provider=generic
```</sentence>
		</paragraph>
		<paragraph id="9">
			<sentence id="9.1">Provide additional environment details (AWS, VirtualBox, physical, etc.):
Physical machines</sentence>
		</paragraph>
		<paragraph id="10">
			<sentence id="10.1">**List the steps to reproduce the issue:**</sentence>
			<sentence id="10.2">1 Mount an NFS location as /var/lib/docker/volumes on 2 docker engines</sentence>
			<sentence id="10.3">2 Create a volume, named `example` when running a container on 1st docker engine</sentence>
			<sentence id="10.4">3 Perform `docker volume ls` on the other docker engine - the volume will not be listed.</sentence>
			<sentence id="10.5">`volume rm` or `volume inspect` will not work either.</sentence>
			<sentence id="10.6">4 Create a new container on the 2nd docker engine with the `-v example:/path` - this container on the second host is able to read the volume.</sentence>
			<sentence id="10.7">5 Restart 2nd docker engine, `docker volume ls` will list this volume.</sentence>
		</paragraph>
		<paragraph id="11">
			<sentence id="11.1">**Describe the results you received:**</sentence>
			<sentence id="11.2">A docker engine only scans the volumes directory upon startup, as seen [here](https://github.com/docker/docker/blob/master/volume/local/local.go#L79).</sentence>
			<sentence id="11.3">After that, the data structure used by the local driver knows only about volumes that were created, deleted by the docker engine running on that particular host.</sentence>
			<sentence id="11.4">If changes happened from another docker-engine to this shared network location, the docker engine doesn't seem to pick it up.</sentence>
		</paragraph>
		<paragraph id="12">
			<sentence id="12.1">**Describe the results you expected:**</sentence>
			<sentence id="12.2">If behaviour were changed to listing all volumes under that folder, and not only the ones created by the docker-engine running on that particular host, multi-host volume management will probably become much easier and not need much more than the local volume plugin.</sentence>
		</paragraph>
		<paragraph id="13">
			<sentence id="13.1">There is probably additional complexity here which I'm not appreciating, but just wanted to raise this anyway.</sentence>
		</paragraph>
	</description>
</bug>
