<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
	<id>12061</id>
	<title>Automatically created host directories for mounts take permissions for daemon umask</title>
	<description>
		<paragraph id="1">
			<sentence id="1.1">This was a bit of a surprise for me but may be the way it is expected to work.</sentence>
			<sentence id="1.2">If you use docker run to start a container with a volume mount to a host directory that doesn't exist, docker will create it automatically.</sentence>
			<sentence id="1.3">The surprising part is that this directory is created with the permissions and ownership of the docker daemon.</sentence>
			<sentence id="1.4">(ie.</sentence>
			<sentence id="1.5">not of the account currently running the docker command)</sentence>
		</paragraph>
		<paragraph id="2">
			<sentence id="2.1">For example:</sentence>
		</paragraph>
		<paragraph id="3">
			<sentence id="3.1">```</sentence>
			<sentence id="3.2">~# id</sentence>
			<sentence id="3.3">uid=0(root) gid=0(root) groups=0(root)</sentence>
			<sentence id="3.4">~# umask</sentence>
			<sentence id="3.5">0022</sentence>
			<sentence id="3.6">~# pwd</sentence>
			<sentence id="3.7">/root</sentence>
			<sentence id="3.8">~# ls -al</sentence>
			<sentence id="3.9">drwx------ 12 root root 4096 Oct 16 11:33 .</sentence>
			<sentence id="3.10">drwxr-xr-x 27 root root 4096 Mar 9 19:19 ..</sentence>
			<sentence id="3.11">~# docker run --rm -v /root/first_dir:/mnt ubuntu date</sentence>
			<sentence id="3.12">Fri Apr 3 19:03:28 UTC 2015</sentence>
			<sentence id="3.13">~# ls -al</sentence>
			<sentence id="3.14">drwx------ 13 root root 4096 Apr 3 14:03 .</sentence>
			<sentence id="3.15">drwxr-xr-x 27 root root 4096 Mar 9 19:19 ..</sentence>
			<sentence id="3.16">drwxr-xr-x 2 root root 4096 Apr 3 14:03 first_dir</sentence>
			<sentence id="3.17">~# umask 077</sentence>
			<sentence id="3.18">~# docker run --rm -v /root/second_dir:/mnt ubuntu date</sentence>
			<sentence id="3.19">Fri Apr 3 19:03:53 UTC 2015</sentence>
			<sentence id="3.20">~# ls -al</sentence>
			<sentence id="3.21">total 68</sentence>
			<sentence id="3.22">drwx------ 14 root root 4096 Apr 3 14:03 .</sentence>
			<sentence id="3.23">drwxr-xr-x 27 root root 4096 Mar 9 19:19 ..</sentence>
			<sentence id="3.24">drwxr-xr-x 2 root root 4096 Apr 3 14:03 first_dir</sentence>
			<sentence id="3.25">drwxr-xr-x 2 root root 4096 Apr 3 14:03 second_dir</sentence>
			<sentence id="3.26">``` </sentence>
		</paragraph>
		<paragraph id="4">
			<sentence id="4.1">That this means is that if you want to set the permissions of the host directory, you must created it explicitly before running docker.</sentence>
			<sentence id="4.2">Not sure if this should be changed, but it may be useful to allow users to pass an option to docker run to set the permissions (and ownership?)</sentence>
			<sentence id="4.3">of the host directory that docker is creating for them.</sentence>
		</paragraph>
	</description>
</bug>
