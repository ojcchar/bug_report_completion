<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
	<id>12386</id>
	<title>hack/install.sh should encourage installation of linux-image-generic on Ubuntu</title>
	<description>
		<paragraph id="1">
			<sentence id="1.1">I installed Docker on Ubuntu 14.04 under OpenStack using the [standard install script][is], built some images and then started some containers.</sentence>
			<sentence id="1.2">Then I ran a `dist-upgrade` on the host, which installed a new kernel version, and rebooted.</sentence>
			<sentence id="1.3">When the machine came back up, all my containers and images were missing.</sentence>
		</paragraph>
		<paragraph id="2">
			<sentence id="2.1">I think this is because the `aufs` kernel module was missing from the new kernel.</sentence>
			<sentence id="2.2">I don't know for sure, because in the process of debugging this I deleted the stuff in `/var/lib/docker`.</sentence>
			<sentence id="2.3">Oops :)</sentence>
		</paragraph>
		<paragraph id="3">
			<sentence id="3.1">I think the reason this happened is:</sentence>
		</paragraph>
		<paragraph id="4">
			<sentence id="4.1">- The installation script installs the `linux-image-extra...` package specific to the currently-running kernel.</sentence>
			<sentence id="4.2">- The OpenStack Ubuntu image doesn't come with `linux-image-generic` installed; it has `linux-image-virtual`, which does not depend on the `-extra` package.</sentence>
			<sentence id="4.3">- When I ran the upgrade, the kernel was upgraded but the `-extra` package was not, meaning the `aufs` driver went missing.</sentence>
		</paragraph>
		<paragraph id="5">
			<sentence id="5.1">Perhaps the install script should show a warning if the `linux-image-generic` package is not installed?</sentence>
		</paragraph>
		<paragraph id="6">
			<sentence id="6.1">`docker version`:
```
Client version: 1.5.0
Client API version: 1.17
Go version (client): go1.4.1
Git commit (client): a8a31ef
OS/Arch (client): linux/amd64
Server version: 1.5.0
Server API version: 1.17
Go version (server): go1.4.1
Git commit (server): a8a31ef
```</sentence>
		</paragraph>
		<paragraph id="7">
			<sentence id="7.1">`docker info`:
```
Containers: 0
Images: 29
Storage Driver: aufs
 Root Dir: /var/lib/docker/aufs
 Backing Filesystem: extfs
 Dirs: 29
Execution Driver: native-0.2
Kernel Version: 3.13.0-49-generic
Operating System: Ubuntu 14.04.2 LTS
CPUs: 4
Total Memory: 7.798 GiB
Name: foo
ID: bar
WARNING: No swap limit support
```</sentence>
		</paragraph>
		<paragraph id="8">
			<sentence id="8.1">`uname -a`:
```
Linux foo 3.13.0-49-generic #83-Ubuntu SMP Fri Apr 10 20:11:33 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux
```</sentence>
		</paragraph>
		<paragraph id="9">
			<sentence id="9.1">[is]: https://get.docker.com/</sentence>
		</paragraph>
	</description>
</bug>
