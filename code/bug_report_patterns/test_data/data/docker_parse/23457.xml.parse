<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
	<id>23457</id>
	<title>Slow docker commit for some containers</title>
	<description>
		<paragraph id="1">
			<sentence id="1.1">When doing a docker commit of one of our containers it takes between 15-20 seconds to return.</sentence>
			<sentence id="1.2">If we make a container from that commit and then do a commit of the new container , the time is ok (&lt; 1 second).</sentence>
			<sentence id="1.3">Both containers run ok, and we cannot find similar problems with other containers.</sentence>
			<sentence id="1.4">All our containers run on an overlay network
The only difference we can note is when tracing the commit and find a request to our consul server (5ca65a... is our overlay network) :</sentence>
		</paragraph>
		<paragraph id="2">
			<sentence id="2.1">GET /v1/kv/docker/network/v1.0/endpoint_count/5ca65a94cf46306701c5100389d9c22fd29492c0d0efb94edbf179fda51fb307/?</sentence>
			<sentence id="2.2">consistent= HTTP/1.1</sentence>
		</paragraph>
		<paragraph id="3">
			<sentence id="3.1">This request takes around 15 seconds to return, which seems similar to the time that takes to create the commit.</sentence>
			<sentence id="3.2">Every time we made a commit of "that container" that request appears.</sentence>
			<sentence id="3.3">But this request not happen when doing the commit for second container and not happen when committing other containers.</sentence>
		</paragraph>
		<paragraph id="4">
			<sentence id="4.1">We use docker swarm, but the same happened when doing the commits directly on the docker engine.</sentence>
			<sentence id="4.2">Don't understand why a commit needs to get information from the network to create the image.</sentence>
		</paragraph>
		<paragraph id="5">
			<sentence id="5.1">Containers: 1693
 Running: 21
 Paused: 0
 Stopped: 1672
Images: 1701
Server Version: 1.10.3
Storage Driver: aufs
 Root Dir: /var/lib/docker/aufs
 Backing Filesystem: extfs
 Dirs: 3680
 Dirperm1 Supported: false
Execution Driver: native-0.2
Logging Driver: json-file
Plugins: 
 Volume: local
 Network: overlay bridge null host
Kernel Version: 3.13.0-85-generic
Operating System: Ubuntu 14.04.4 LTS
OSType: linux
Architecture: x86_64
CPUs: 4
Total Memory: 15.67 GiB
Name: ip-172-21-0-218
ID: FRFE:ZLD6:J6SJ:FWTB:GZG5:SAGL:MYV3:PJX4:IUGK:LNTM:6VDI:MACN
WARNING: No swap limit support
Cluster store: consul://172.21.2.90:8501
Cluster advertise: 172.21.0.218:2375</sentence>
		</paragraph>
		<paragraph id="6">
			<sentence id="6.1">[docker_inspect_overlay_network.</sentence>
			<sentence id="6.2">txt](https://github.com/docker/docker/files/310349/docker_inspect_overlay_network.txt)
[docker_inspect_container_with_normal_commit.</sentence>
			<sentence id="6.3">txt](https://github.com/docker/docker/files/310350/docker_inspect_container_with_normal_commit.txt)
[docker_inspect_container_with_slow_commit.</sentence>
			<sentence id="6.4">txt](https://github.com/docker/docker/files/310351/docker_inspect_container_with_slow_commit.txt)</sentence>
		</paragraph>
	</description>
</bug>
