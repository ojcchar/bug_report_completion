<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
	<id>49768</id>
	<title>[FIXED] Piped Log over /bin/sh/ -c</title>
	<description>
		<paragraph id="1">
			<sentence id="1.1">Hello ;</sentence>
		</paragraph>
		<paragraph id="2">
			<sentence id="2.1">With Apache version 2.2.16 (under Debian Squeeze) I've problem with a Piped log script.</sentence>
		</paragraph>
		<paragraph id="3">
			<sentence id="3.1">Explanation:</sentence>
		</paragraph>
		<paragraph id="4">
			<sentence id="4.1">When run under Debian Lenny (Apache version 2.2.9), Apache spawn the log script directly.</sentence>
			<sentence id="4.2">So, only one process appert when I run the 'px aux' command'.</sentence>
		</paragraph>
		<paragraph id="5">
			<sentence id="5.1">Example for the Piped Error log:</sentence>
		</paragraph>
		<paragraph id="6">
			<sentence id="6.1">root      1253  0.0  0.2   5208  1364 pts/0    S+   18:16   0:00 /usr/bin/perl /var/www/ispcp/engine/ispcp-apache-logger -e</sentence>
		</paragraph>
		<paragraph id="7">
			<sentence id="7.1">But under the latest Apache version (2.2.16), the script seem to be run over the '/bin/sh -c' command.</sentence>
		</paragraph>
		<paragraph id="8">
			<sentence id="8.1">root      1550  0.0  0.0   1748   484 pts/0    S+   18:16   0:00 /bin/sh -c /var/www/ispcp/engine/ispcp-apache-logger -e
root      1551  0.0  0.2   5208  1364 pts/0    S+   18:16   0:00 /usr/bin/perl /var/www/ispcp/engine/ispcp-apache-logger</sentence>
		</paragraph>
		<paragraph id="9">
			<sentence id="9.1">I don't know why apache process like this now but this way is not good for me because now, I unable to trap any signal from my perl script.</sentence>
		</paragraph>
		<paragraph id="10">
			<sentence id="10.1">Some info about my configuration:</sentence>
		</paragraph>
		<paragraph id="11">
			<sentence id="11.1">My relevant Apache configuration:</sentence>
		</paragraph>
		<paragraph id="12">
			<sentence id="12.1">LogFormat "%v %h %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" ispcplog</sentence>
		</paragraph>
		<paragraph id="13">
			<sentence id="13.1">CustomLog "| /var/www/ispcp/engine/ispcp-apache-logger" ispcplog
ErrorLog "| /var/www/ispcp/engine/ispcp-apache-logger -e"</sentence>
		</paragraph>
		<paragraph id="14">
			<sentence id="14.1">dev:/home/nuxwin# uname -a
Linux dev 2.6.26-2-686 #1 SMP Mon Jun 21 05:58:44 UTC 2010 i686 GNU/Linux</sentence>
		</paragraph>
		<paragraph id="15">
			<sentence id="15.1">root@ispcp:~# apachectl -V</sentence>
			<sentence id="15.2">Server version: Apache/2.2.16 (Debian)</sentence>
			<sentence id="15.3">Server built:   Jul 24 2010 20:24:16</sentence>
			<sentence id="15.4">Server's Module Magic Number: 20051115:24</sentence>
			<sentence id="15.5">Server loaded:  APR 1.4.2, APR-Util 1.3.9</sentence>
			<sentence id="15.6">Compiled using: APR 1.4.2, APR-Util 1.3.9</sentence>
			<sentence id="15.7">Architecture:   32-bit</sentence>
			<sentence id="15.8">Server MPM:     Worker</sentence>
			<sentence id="15.9">threaded:     yes (fixed thread count)</sentence>
			<sentence id="15.10">forked:     yes (variable process count)</sentence>
			<sentence id="15.11">Server compiled with....</sentence>
			<sentence id="15.12">-D APACHE_MPM_DIR="server/mpm/worker"</sentence>
			<sentence id="15.13">-D APR_HAS_SENDFILE</sentence>
			<sentence id="15.14">-D APR_HAS_MMAP</sentence>
			<sentence id="15.15">-D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)</sentence>
			<sentence id="15.16">-D APR_USE_SYSVSEM_SERIALIZE</sentence>
			<sentence id="15.17">-D APR_USE_PTHREAD_SERIALIZE</sentence>
			<sentence id="15.18">-D SINGLE_LISTEN_UNSERIALIZED_ACCEPT</sentence>
			<sentence id="15.19">-D APR_HAS_OTHER_CHILD</sentence>
			<sentence id="15.20">-D AP_HAVE_RELIABLE_PIPED_LOGS</sentence>
			<sentence id="15.21">-D DYNAMIC_MODULE_LIMIT=128</sentence>
			<sentence id="15.22">-D HTTPD_ROOT="/etc/apache2"</sentence>
			<sentence id="15.23">-D SUEXEC_BIN="/usr/lib/apache2/suexec"</sentence>
			<sentence id="15.24">-D DEFAULT_PIDLOG="/var/run/apache2.</sentence>
			<sentence id="15.25">pid"</sentence>
			<sentence id="15.26">-D DEFAULT_SCOREBOARD="logs/apache_runtime_status"</sentence>
			<sentence id="15.27">-D DEFAULT_ERRORLOG="logs/error_log"</sentence>
			<sentence id="15.28">-D AP_TYPES_CONFIG_FILE="mime.types"</sentence>
			<sentence id="15.29">-D SERVER_CONFIG_FILE="apache2.conf"</sentence>
			<sentence id="15.30">root@ispcp:~# uname -a</sentence>
			<sentence id="15.31">Linux ispcp 2.6.32-5-686 #1 SMP Sat Jul 24 02:27:10 UTC 2010 i686 GNU/Linux</sentence>
		</paragraph>
		<paragraph id="16">
			<sentence id="16.1">Note: Sorry for my poor English, I'm french.</sentence>
		</paragraph>
	</description>
</bug>
