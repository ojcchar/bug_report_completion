<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
    <id>TRUNK-2714</id>
    <title>Opening schema of a form attached to an xform throws an exception</title>
    <description>
        <paragraph id="1">
            <sentence id="1.1">After creating a form, when i go to the form list page and select it, it throws an exception with the following stack trace:</sentence>
        </paragraph>
        <paragraph id="2">
            <sentence id="2.1">INFO - LoggingAdvice.invoke(142) |2011-10-04 00:01:58,597| Exiting method saveFormResource</sentence>
            <sentence id="2.2">ERROR - errorhandler_jsp._jspService(72) |2011-10-04 00:01:58,664| Error on page /openmrs-1.9.0/errorhandler.jsp</sentence>
            <sentence id="2.3">javax.el.ELException: Error reading 'links' on type org.openmrs.module.xforms.extension.html.XformsFormHeaderExt</sentence>
            <sentence id="2.4">	at javax.el.BeanELResolver.getValue(BeanELResolver.java:66)</sentence>
            <sentence id="2.5">	at javax.el.CompositeELResolver.getValue(CompositeELResolver.java:54)</sentence>
            <sentence id="2.6">	at org.apache.el.parser.AstValue.getValue(AstValue.java:123)</sentence>
            <sentence id="2.7">	at org.apache.el.ValueExpressionImpl.getValue(ValueExpressionImpl.java:186)</sentence>
            <sentence id="2.8">	at org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate(PageContextImpl.java:935)</sentence>
            <sentence id="2.9">	at org.apache.jsp.WEB_002dINF.view.admin.forms.formEditForm_jsp._jspx_meth_c_005fforEach_005f4(formEditForm_jsp.java:5328)</sentence>
            <sentence id="2.10">	at org.apache.jsp.WEB_002dINF.view.admin.forms.formEditForm_jsp._jspx_meth_openmrs_005fextensionPoint_005f5(formEditForm_jsp.java:5298)</sentence>
            <sentence id="2.11">	at org.apache.jsp.WEB_002dINF.view.admin.forms.formEditForm_jsp._jspx_meth_c_005fif_005f24(formEditForm_jsp.java:5257)</sentence>
            <sentence id="2.12">	at org.apache.jsp.WEB_002dINF.view.admin.forms.formEditForm_jsp._jspx_meth_c_005fif_005f23(formEditForm_jsp.java:5197)</sentence>
            <sentence id="2.13">	at org.apache.jsp.WEB_002dINF.view.admin.forms.formEditForm_jsp._jspService(formEditForm_jsp.java:935)</sentence>
            <sentence id="2.14">	at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)</sentence>
            <sentence id="2.15">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)</sentence>
            <sentence id="2.16">	at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:377)</sentence>
            <sentence id="2.17">	at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:313)</sentence>
            <sentence id="2.18">	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:260)</sentence>
            <sentence id="2.19">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)</sentence>
            <sentence id="2.20">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)</sentence>
            <sentence id="2.21">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="2.22">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:70)</sentence>
            <sentence id="2.23">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="2.24">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="2.25">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:70)</sentence>
            <sentence id="2.26">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="2.27">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="2.28">	at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:646)</sentence>
            <sentence id="2.29">	at org.apache.catalina.core.ApplicationDispatcher.processRequest(ApplicationDispatcher.java:436)</sentence>
            <sentence id="2.30">	at org.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationDispatcher.java:374)</sentence>
            <sentence id="2.31">	at org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDispatcher.java:302)</sentence>
            <sentence id="2.32">	at org.springframework.web.servlet.view.InternalResourceView.renderMergedOutputModel(InternalResourceView.java:238)</sentence>
            <sentence id="2.33">	at org.springframework.web.servlet.view.AbstractView.render(AbstractView.java:250)</sentence>
            <sentence id="2.34">	at org.springframework.web.servlet.DispatcherServlet.render(DispatcherServlet.java:1047)</sentence>
            <sentence id="2.35">	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:817)</sentence>
            <sentence id="2.36">	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:719)</sentence>
            <sentence id="2.37">	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:644)</sentence>
            <sentence id="2.38">	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:549)</sentence>
            <sentence id="2.39">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:617)</sentence>
            <sentence id="2.40">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)</sentence>
            <sentence id="2.41">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)</sentence>
            <sentence id="2.42">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="2.43">	at org.openmrs.module.web.filter.ForcePasswordChangeFilter.doFilter(ForcePasswordChangeFilter.java:65)</sentence>
            <sentence id="2.44">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="2.45">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="2.46">	at org.openmrs.module.web.filter.ModuleFilterChain.doFilter(ModuleFilterChain.java:76)</sentence>
            <sentence id="2.47">	at org.openmrs.module.xforms.web.XformsFilter.doFilter(XformsFilter.java:60)</sentence>
            <sentence id="2.48">	at org.openmrs.module.web.filter.ModuleFilterChain.doFilter(ModuleFilterChain.java:74)</sentence>
            <sentence id="2.49">	at org.openmrs.module.web.filter.ModuleFilter.doFilter(ModuleFilter.java:58)</sentence>
            <sentence id="2.50">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="2.51">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="2.52">	at org.openmrs.web.filter.OpenmrsFilter.doFilterInternal(OpenmrsFilter.java:111)</sentence>
            <sentence id="2.53">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)</sentence>
            <sentence id="2.54">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="2.55">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="2.56">	at org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:198)</sentence>
            <sentence id="2.57">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)</sentence>
            <sentence id="2.58">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="2.59">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="2.60">	at org.openmrs.web.filter.StartupFilter.doFilter(StartupFilter.java:83)</sentence>
            <sentence id="2.61">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="2.62">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="2.63">	at org.openmrs.web.filter.StartupFilter.doFilter(StartupFilter.java:83)</sentence>
            <sentence id="2.64">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="2.65">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="2.66">	at org.openmrs.web.filter.StartupFilter.doFilter(StartupFilter.java:83)</sentence>
            <sentence id="2.67">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="2.68">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="2.69">	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:88)</sentence>
            <sentence id="2.70">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)</sentence>
            <sentence id="2.71">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="2.72">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="2.73">	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)</sentence>
            <sentence id="2.74">	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)</sentence>
            <sentence id="2.75">	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)</sentence>
            <sentence id="2.76">	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)</sentence>
            <sentence id="2.77">	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)</sentence>
            <sentence id="2.78">	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)</sentence>
            <sentence id="2.79">	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:852)</sentence>
            <sentence id="2.80">	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:588)</sentence>
            <sentence id="2.81">	at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)</sentence>
            <sentence id="2.82">	at java.lang.Thread.run(Thread.java:680)</sentence>
            <sentence id="2.83">Caused by: org.springframework.transaction.UnexpectedRollbackException: Transaction rolled back because it has been marked as rollback-only</sentence>
            <sentence id="2.84">	at org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:717)</sentence>
            <sentence id="2.85">	at org.springframework.transaction.interceptor.TransactionAspectSupport.commitTransactionAfterReturning(TransactionAspectSupport.java:393)</sentence>
            <sentence id="2.86">	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:120)</sentence>
            <sentence id="2.87">	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)</sentence>
            <sentence id="2.88">	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:202)</sentence>
            <sentence id="2.89">	at $Proxy928.saveFormResource(Unknown Source)</sentence>
            <sentence id="2.90">	at org.openmrs.Form.setXslt(Form.java:228)</sentence>
            <sentence id="2.91">	at org.openmrs.module.xforms.BasicFormBuilder.addDefaultFields(BasicFormBuilder.java:46)</sentence>
            <sentence id="2.92">	at org.openmrs.module.xforms.extension.html.XformsFormHeaderExt.getLinks(XformsFormHeaderExt.java:63)</sentence>
            <sentence id="2.93">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</sentence>
            <sentence id="2.94">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)</sentence>
            <sentence id="2.95">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)</sentence>
            <sentence id="2.96">	at java.lang.reflect.Method.invoke(Method.java:597)</sentence>
            <sentence id="2.97">	at javax.el.BeanELResolver.getValue(BeanELResolver.java:62)</sentence>
            <sentence id="2.98">	... 78 more</sentence>
        </paragraph>
    </description>
</bug>
