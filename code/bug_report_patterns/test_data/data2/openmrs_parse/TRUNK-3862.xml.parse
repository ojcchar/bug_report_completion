<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
    <id>TRUNK-3862</id>
    <title>Unnecessary logged exceptions when saving forms (Save Handlers should ignore deprecated properties)</title>
    <description>
        <paragraph id="1">
            <sentence id="1.1">Since OpenMRS 1.9, when we moved Form's XSLT and template columns into FormResources, there's a long, misleading, and unnecessary amount of exception logged every time the FormService.saveForm method is called.</sentence>
        </paragraph>
        <paragraph id="2">
            <sentence id="2.1">For example, when I build the EMR module for Mirebalais, I get a longer version of this:</sentence>
        </paragraph>
        <paragraph id="3">
            <sentence id="3.1">{code}</sentence>
            <sentence id="3.2">Running org.openmrs.module.emr.htmlform.EnterHtmlFormTaskComponentTest</sentence>
            <sentence id="3.3">WARN - OpenmrsObjectSaveHandler.handle(116) |2012-12-27 15:41:00,084| Failed to access property template; accessor threw exception.</sentence>
            <sentence id="3.4">java.lang.reflect.InvocationTargetException</sentence>
            <sentence id="3.5">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</sentence>
            <sentence id="3.6">...</sentence>
            <sentence id="3.7">	at org.apache.commons.beanutils.PropertyUtils.getProperty(PropertyUtils.java:290)</sentence>
            <sentence id="3.8">	at org.openmrs.api.handler.OpenmrsObjectSaveHandler.handle(OpenmrsObjectSaveHandler.java:87)</sentence>
            <sentence id="3.9">	at org.openmrs.aop.RequiredDataAdvice.recursivelyHandle(RequiredDataAdvice.java:268)</sentence>
            <sentence id="3.10">...</sentence>
            <sentence id="3.11">Caused by: java.lang.UnsupportedOperationException: Templates no longer exist on Forms. Use Form Attributes.</sentence>
            <sentence id="3.12">	at org.openmrs.Form.getTemplate(Form.java:141)</sentence>
            <sentence id="3.13">	... 69 more</sentence>
            <sentence id="3.14">{code}</sentence>
        </paragraph>
        <paragraph id="4">
            <sentence id="4.1">I've been thinking about how we can stop this, and my current thought is to go through all of our handlers, and for each one that recurses on the object's properties (e.g. OpenmrsObjectSaveHandler recurses on all String properties to trim them), we should skip over @Deprecated properties.</sentence>
        </paragraph>
        <paragraph id="5">
            <sentence id="5.1">Proposed solution:</sentence>
            <sentence id="5.2">* Go through RequiredDataAdvice, and all handler classes that may be called from it (e.g. OpenmrsObjectSaveHandler) and ensure that every time we iterate over properties, we skip ones whose getter/setter is annotated with @Deprecated.</sentence>
        </paragraph>
    </description>
</bug>
