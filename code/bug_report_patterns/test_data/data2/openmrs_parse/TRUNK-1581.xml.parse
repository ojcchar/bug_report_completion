<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
    <id>TRUNK-1581</id>
    <title>ClassNotFoundException (org.openmrs.module.birt.BirtReport) on session loading during Tomcat startup</title>
    <description>
        <paragraph id="1">
            <sentence id="1.1">When Tomcat is started, it tries to load objects that were persisted during the last Tomcat shutdown.</sentence>
            <sentence id="1.2">Objects that were stored in the session during runtime are persisted to the file system when Tomcat stops executing.</sentence>
            <sentence id="1.3">Objects created by OpenMRS modules are sometimes stored in the session, which means they need to be available when OpenMRS classes are loaded into the classloader (i.e. during Tomcat startup).</sentence>
            <sentence id="1.4">However, these module classes are not loaded into the classloader until after the OpenMRS starts up.</sentence>
            <sentence id="1.5">Therefore, Tomcat cannot load these module objects into the session during startup.</sentence>
        </paragraph>
        <paragraph id="2">
            <sentence id="2.1">Possible solutions:</sentence>
            <sentence id="2.2">1 Disable Tomcat's default session persistence / loading mechanism by override the OpenMRS webapp's context.xml</sentence>
            <sentence id="2.3">2 Figure out a way to load all classes (from code API, web, modules) at once</sentence>
        </paragraph>
        <paragraph id="3">
            <sentence id="3.1">ERROR - StandardManager.doLoad(400) |2007-04-17 16:51:34,539| ClassNotFoundException while loading persisted sessions: java.lang.ClassNotFoundException: org.openmrs.module.birt.BirtReport</sentence>
            <sentence id="3.2">java.lang.ClassNotFoundException: org.openmrs.module.birt.BirtReport</sentence>
            <sentence id="3.3">        at java.net.URLClassLoader$1.run(Unknown Source)</sentence>
            <sentence id="3.4">        at java.security.AccessController.doPrivileged(Native Method)</sentence>
            <sentence id="3.5">        at java.net.URLClassLoader.findClass(Unknown Source)</sentence>
            <sentence id="3.6">        at java.lang.ClassLoader.loadClass(Unknown Source)</sentence>
            <sentence id="3.7">        at java.lang.ClassLoader.loadClass(Unknown Source)</sentence>
            <sentence id="3.8">        at java.lang.ClassLoader.loadClassInternal(Unknown Source)</sentence>
            <sentence id="3.9">        at java.lang.Class.forName0(Native Method)</sentence>
            <sentence id="3.10">        at java.lang.Class.forName(Unknown Source)</sentence>
            <sentence id="3.11">        at java.io.ObjectInputStream.resolveClass(Unknown Source)</sentence>
            <sentence id="3.12">        at org.apache.catalina.util.CustomObjectInputStream.resolveClass(CustomObjectInputStream.java:77)</sentence>
            <sentence id="3.13">        at java.io.ObjectInputStream.readNonProxyDesc(Unknown Source)</sentence>
            <sentence id="3.14">        at java.io.ObjectInputStream.readClassDesc(Unknown Source)</sentence>
            <sentence id="3.15">        at java.io.ObjectInputStream.readOrdinaryObject(Unknown Source)</sentence>
            <sentence id="3.16">        at java.io.ObjectInputStream.readObject0(Unknown Source)</sentence>
            <sentence id="3.17">        at java.io.ObjectInputStream.readArray(Unknown Source)</sentence>
            <sentence id="3.18">        at java.io.ObjectInputStream.readObject0(Unknown Source)</sentence>
            <sentence id="3.19">        at java.io.ObjectInputStream.defaultReadFields(Unknown Source)</sentence>
            <sentence id="3.20">        at java.io.ObjectInputStream.readSerialData(Unknown Source)</sentence>
            <sentence id="3.21">        at java.io.ObjectInputStream.readOrdinaryObject(Unknown Source)</sentence>
            <sentence id="3.22">        at java.io.ObjectInputStream.readObject0(Unknown Source)</sentence>
            <sentence id="3.23">        at java.io.ObjectInputStream.readObject(Unknown Source)</sentence>
            <sentence id="3.24">        at org.apache.catalina.session.StandardSession.readObject(StandardSession.java:1386)</sentence>
            <sentence id="3.25">        at org.apache.catalina.session.StandardSession.readObjectData(StandardSession.java:921)</sentence>
            <sentence id="3.26">        at org.apache.catalina.session.StandardManager.doLoad(StandardManager.java:393)</sentence>
            <sentence id="3.27">        at org.apache.catalina.session.StandardManager.load(StandardManager.java:320)</sentence>
            <sentence id="3.28">        at org.apache.catalina.session.StandardManager.start(StandardManager.java:636)</sentence>
            <sentence id="3.29">        at org.apache.catalina.core.ContainerBase.setManager(ContainerBase.java:431)</sentence>
            <sentence id="3.30">        at org.apache.catalina.core.StandardContext.start(StandardContext.java:4131)</sentence>
            <sentence id="3.31">        at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:759)</sentence>
            <sentence id="3.32">        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:739)</sentence>
            <sentence id="3.33">        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:524)</sentence>
            <sentence id="3.34">        at org.apache.catalina.startup.HostConfig.deployDescriptor(HostConfig.java:608)</sentence>
            <sentence id="3.35">        at org.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:535)</sentence>
            <sentence id="3.36">        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:470)</sentence>
            <sentence id="3.37">        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1122)</sentence>
            <sentence id="3.38">        at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:310)</sentence>
            <sentence id="3.39">        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)</sentence>
            <sentence id="3.40">        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1021)</sentence>
            <sentence id="3.41">        at org.apache.catalina.core.StandardHost.start(StandardHost.java:718)</sentence>
            <sentence id="3.42">        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1013)</sentence>
            <sentence id="3.43">        at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:442)</sentence>
            <sentence id="3.44">        at org.apache.catalina.core.StandardService.start(StandardService.java:450)</sentence>
            <sentence id="3.45">        at org.apache.catalina.core.StandardServer.start(StandardServer.java:709)</sentence>
            <sentence id="3.46">        at org.apache.catalina.startup.Catalina.start(Catalina.java:551)</sentence>
            <sentence id="3.47">        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</sentence>
            <sentence id="3.48">        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)</sentence>
            <sentence id="3.49">        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)</sentence>
            <sentence id="3.50">        at java.lang.reflect.Method.invoke(Unknown Source)</sentence>
            <sentence id="3.51">        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:294)</sentence>
            <sentence id="3.52">        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:432)</sentence>
            <sentence id="3.53">ERROR - StandardManager.start(638) |2007-04-17 16:51:34,569| Exception loading sessions from persistent storage</sentence>
            <sentence id="3.54">java.lang.ClassNotFoundException: org.openmrs.module.birt.BirtReport</sentence>
            <sentence id="3.55">        at java.net.URLClassLoader$1.run(Unknown Source)</sentence>
            <sentence id="3.56">        at java.security.AccessController.doPrivileged(Native Method)</sentence>
            <sentence id="3.57">        at java.net.URLClassLoader.findClass(Unknown Source)</sentence>
            <sentence id="3.58">        at java.lang.ClassLoader.loadClass(Unknown Source)</sentence>
            <sentence id="3.59">        at java.lang.ClassLoader.loadClass(Unknown Source)</sentence>
            <sentence id="3.60">        at java.lang.ClassLoader.loadClassInternal(Unknown Source)</sentence>
            <sentence id="3.61">        at java.lang.Class.forName0(Native Method)</sentence>
            <sentence id="3.62">        at java.lang.Class.forName(Unknown Source)</sentence>
            <sentence id="3.63">        at java.io.ObjectInputStream.resolveClass(Unknown Source)</sentence>
            <sentence id="3.64">        at org.apache.catalina.util.CustomObjectInputStream.resolveClass(CustomObjectInputStream.java:77)</sentence>
            <sentence id="3.65">        at java.io.ObjectInputStream.readNonProxyDesc(Unknown Source)</sentence>
            <sentence id="3.66">        at java.io.ObjectInputStream.readClassDesc(Unknown Source)</sentence>
            <sentence id="3.67">        at java.io.ObjectInputStream.readOrdinaryObject(Unknown Source)</sentence>
            <sentence id="3.68">        at java.io.ObjectInputStream.readObject0(Unknown Source)</sentence>
            <sentence id="3.69">        at java.io.ObjectInputStream.readArray(Unknown Source)</sentence>
            <sentence id="3.70">        at java.io.ObjectInputStream.readObject0(Unknown Source)</sentence>
            <sentence id="3.71">        at java.io.ObjectInputStream.defaultReadFields(Unknown Source)</sentence>
            <sentence id="3.72">        at java.io.ObjectInputStream.readSerialData(Unknown Source)</sentence>
            <sentence id="3.73">        at java.io.ObjectInputStream.readOrdinaryObject(Unknown Source)</sentence>
            <sentence id="3.74">        at java.io.ObjectInputStream.readObject0(Unknown Source)</sentence>
            <sentence id="3.75">        at java.io.ObjectInputStream.readObject(Unknown Source)</sentence>
            <sentence id="3.76">        at org.apache.catalina.session.StandardSession.readObject(StandardSession.java:1386)</sentence>
            <sentence id="3.77">        at org.apache.catalina.session.StandardSession.readObjectData(StandardSession.java:921)</sentence>
            <sentence id="3.78">        at org.apache.catalina.session.StandardManager.doLoad(StandardManager.java:393)</sentence>
            <sentence id="3.79">        at org.apache.catalina.session.StandardManager.load(StandardManager.java:320)</sentence>
            <sentence id="3.80">        at org.apache.catalina.session.StandardManager.start(StandardManager.java:636)</sentence>
            <sentence id="3.81">        at org.apache.catalina.core.ContainerBase.setManager(ContainerBase.java:431)</sentence>
            <sentence id="3.82">        at org.apache.catalina.core.StandardContext.start(StandardContext.java:4131)</sentence>
            <sentence id="3.83">        at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:759)</sentence>
            <sentence id="3.84">        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:739)</sentence>
            <sentence id="3.85">        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:524)</sentence>
            <sentence id="3.86">        at org.apache.catalina.startup.HostConfig.deployDescriptor(HostConfig.java:608)</sentence>
            <sentence id="3.87">        at org.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:535)</sentence>
            <sentence id="3.88">        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:470)</sentence>
            <sentence id="3.89">        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1122)</sentence>
            <sentence id="3.90">        at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:310)</sentence>
            <sentence id="3.91">        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)</sentence>
            <sentence id="3.92">        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1021)</sentence>
            <sentence id="3.93">        at org.apache.catalina.core.StandardHost.start(StandardHost.java:718)</sentence>
            <sentence id="3.94">        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1013)</sentence>
            <sentence id="3.95">        at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:442)</sentence>
            <sentence id="3.96">        at org.apache.catalina.core.StandardService.start(StandardService.java:450)</sentence>
            <sentence id="3.97">        at org.apache.catalina.core.StandardServer.start(StandardServer.java:709)</sentence>
            <sentence id="3.98">        at org.apache.catalina.startup.Catalina.start(Catalina.java:551)</sentence>
            <sentence id="3.99">        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</sentence>
            <sentence id="3.100">        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)</sentence>
            <sentence id="3.101">        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)</sentence>
            <sentence id="3.102">        at java.lang.reflect.Method.invoke(Unknown Source)</sentence>
            <sentence id="3.103">        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:294)</sentence>
            <sentence id="3.104">        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:432) </sentence>
        </paragraph>
    </description>
</bug>
