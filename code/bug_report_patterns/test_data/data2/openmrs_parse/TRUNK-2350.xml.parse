<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
    <id>TRUNK-2350</id>
    <title>java.lang.ClassCastException while creating a visit</title>
    <description>
        <paragraph id="1">
            <sentence id="1.1">I create a visit Attribute type with the following data,</sentence>
        </paragraph>
        <paragraph id="2">
            <sentence id="2.1">Name :STRING
Description: STRING_ATTRIBUTE_TYPE
Min:1
Max:1
Data Type :String
Handler Config :null</sentence>
        </paragraph>
        <paragraph id="3">
            <sentence id="3.1">I also create a visit type,</sentence>
        </paragraph>
        <paragraph id="4">
            <sentence id="4.1">Name:visit
Description :visitType</sentence>
        </paragraph>
        <paragraph id="5">
            <sentence id="5.1">I now Add a visit,</sentence>
        </paragraph>
        <paragraph id="6">
            <sentence id="6.1">Patient : John D.Patient
Visit type :visit
Start date time: (date)
Indication : (any concept)
I am displayed a test box for  visit attributes (String) There is a single text box.</sentence>
            <sentence id="6.2">Into this I type (TEST)
I click submit</sentence>
        </paragraph>
        <paragraph id="7">
            <sentence id="7.1">And get,</sentence>
        </paragraph>
        <paragraph id="8">
            <sentence id="8.1">An Internal Error has Occurred
java.lang.ClassCastException
java.util.HashSet cannot be cast to java.util.SortedSet</sentence>
        </paragraph>
        <paragraph id="9">
            <sentence id="9.1">Consult the help document.</sentence>
            <sentence id="9.2">Contact your friendly neighborhood administrator if it cannot be resolved.</sentence>
        </paragraph>
        <paragraph id="10">
            <sentence id="10.1">Hide stack trace </sentence>
            <sentence id="10.2">org.hibernate.type.SortedSetType.wrap(SortedSetType.java:49)</sentence>
            <sentence id="10.3">org.hibernate.event.def.WrapVisitor.processArrayOrNewCollection(WrapVisitor.java:84)</sentence>
            <sentence id="10.4">org.hibernate.event.def.WrapVisitor.processCollection(WrapVisitor.java:51)</sentence>
            <sentence id="10.5">org.hibernate.event.def.AbstractVisitor.processValue(AbstractVisitor.java:101)</sentence>
            <sentence id="10.6">org.hibernate.event.def.WrapVisitor.processValue(WrapVisitor.java:98)</sentence>
            <sentence id="10.7">org.hibernate.event.def.AbstractVisitor.processEntityPropertyValues(AbstractVisitor.java:55)</sentence>
            <sentence id="10.8">org.hibernate.event.def.AbstractSaveEventListener.visitCollectionsBeforeSave(AbstractSaveEventListener.java:371)</sentence>
            <sentence id="10.9">org.hibernate.event.def.AbstractSaveEventListener.performSaveOrReplicate(AbstractSaveEventListener.java:273)</sentence>
            <sentence id="10.10">org.hibernate.event.def.AbstractSaveEventListener.performSave(AbstractSaveEventListener.java:181)</sentence>
            <sentence id="10.11">org.hibernate.event.def.AbstractSaveEventListener.saveWithGeneratedId(AbstractSaveEventListener.java:107)</sentence>
            <sentence id="10.12">org.hibernate.event.def.DefaultSaveOrUpdateEventListener.saveWithGeneratedOrRequestedId(DefaultSaveOrUpdateEventListener.java:187)</sentence>
            <sentence id="10.13">org.hibernate.event.def.DefaultSaveOrUpdateEventListener.entityIsTransient(DefaultSaveOrUpdateEventListener.java:172)</sentence>
            <sentence id="10.14">org.hibernate.event.def.DefaultSaveOrUpdateEventListener.performSaveOrUpdate(DefaultSaveOrUpdateEventListener.java:94)</sentence>
            <sentence id="10.15">org.hibernate.event.def.DefaultSaveOrUpdateEventListener.onSaveOrUpdate(DefaultSaveOrUpdateEventListener.java:70)</sentence>
            <sentence id="10.16">org.hibernate.impl.SessionImpl.fireSaveOrUpdate(SessionImpl.java:507)</sentence>
            <sentence id="10.17">org.hibernate.impl.SessionImpl.saveOrUpdate(SessionImpl.java:499)</sentence>
            <sentence id="10.18">org.hibernate.impl.SessionImpl.saveOrUpdate(SessionImpl.java:495)</sentence>
            <sentence id="10.19">org.openmrs.api.db.hibernate.HibernateVisitDAO.saveVisit(HibernateVisitDAO.java:128)</sentence>
            <sentence id="10.20">org.openmrs.api.impl.VisitServiceImpl.saveVisit(VisitServiceImpl.java:160)</sentence>
            <sentence id="10.21">sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</sentence>
            <sentence id="10.22">sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)</sentence>
            <sentence id="10.23">sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)</sentence>
            <sentence id="10.24">java.lang.reflect.Method.invoke(Method.java:597)</sentence>
            <sentence id="10.25">org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:309)</sentence>
            <sentence id="10.26">org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)</sentence>
            <sentence id="10.27">org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)</sentence>
            <sentence id="10.28">org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:110)</sentence>
            <sentence id="10.29">org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)</sentence>
            <sentence id="10.30">org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:202)</sentence>
            <sentence id="10.31">$Proxy135.saveVisit(Unknown Source)</sentence>
            <sentence id="10.32">sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</sentence>
            <sentence id="10.33">sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)</sentence>
            <sentence id="10.34">sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)</sentence>
            <sentence id="10.35">java.lang.reflect.Method.invoke(Method.java:597)</sentence>
            <sentence id="10.36">org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:309)</sentence>
            <sentence id="10.37">org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)</sentence>
            <sentence id="10.38">org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)</sentence>
            <sentence id="10.39">org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:110)</sentence>
            <sentence id="10.40">org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)</sentence>
            <sentence id="10.41">org.openmrs.aop.LoggingAdvice.invoke(LoggingAdvice.java:122)</sentence>
            <sentence id="10.42">org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)</sentence>
            <sentence id="10.43">org.springframework.aop.framework.adapter.MethodBeforeAdviceInterceptor.invoke(MethodBeforeAdviceInterceptor.java:50)</sentence>
            <sentence id="10.44">org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)</sentence>
            <sentence id="10.45">org.springframework.aop.framework.adapter.MethodBeforeAdviceInterceptor.invoke(MethodBeforeAdviceInterceptor.java:50)</sentence>
            <sentence id="10.46">org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)</sentence>
            <sentence id="10.47">org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:202)</sentence>
            <sentence id="10.48">$Proxy136.saveVisit(Unknown Source)</sentence>
            <sentence id="10.49">sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</sentence>
            <sentence id="10.50">sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)</sentence>
            <sentence id="10.51">sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)</sentence>
            <sentence id="10.52">java.lang.reflect.Method.invoke(Method.java:597)</sentence>
            <sentence id="10.53">org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:309)</sentence>
            <sentence id="10.54">org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)</sentence>
            <sentence id="10.55">org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)</sentence>
            <sentence id="10.56">org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:110)</sentence>
            <sentence id="10.57">org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)</sentence>
            <sentence id="10.58">org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:202)</sentence>
            <sentence id="10.59">$Proxy136.saveVisit(Unknown Source)</sentence>
            <sentence id="10.60">org.openmrs.web.controller.visit.VisitFormController.saveVisit(VisitFormController.java:123)</sentence>
            <sentence id="10.61">sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</sentence>
            <sentence id="10.62">sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)</sentence>
            <sentence id="10.63">sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)</sentence>
            <sentence id="10.64">java.lang.reflect.Method.invoke(Method.java:597)</sentence>
            <sentence id="10.65">org.springframework.web.bind.annotation.support.HandlerMethodInvoker.invokeHandlerMethod(HandlerMethodInvoker.java:176)</sentence>
            <sentence id="10.66">org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.invokeHandlerMethod(AnnotationMethodHandlerAdapter.java:426)</sentence>
            <sentence id="10.67">org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.handle(AnnotationMethodHandlerAdapter.java:414)</sentence>
            <sentence id="10.68">org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:790)</sentence>
            <sentence id="10.69">org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:719)</sentence>
            <sentence id="10.70">org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:644)</sentence>
            <sentence id="10.71">org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:560)</sentence>
            <sentence id="10.72">javax.servlet.http.HttpServlet.service(HttpServlet.java:727)</sentence>
            <sentence id="10.73">javax.servlet.http.HttpServlet.service(HttpServlet.java:820)</sentence>
            <sentence id="10.74">org.mortbay.jetty.servlet.ServletHolder.handle(ServletHolder.java:487)</sentence>
            <sentence id="10.75">org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1093)</sentence>
            <sentence id="10.76">org.openmrs.module.web.filter.ForcePasswordChangeFilter.doFilter(ForcePasswordChangeFilter.java:65)</sentence>
            <sentence id="10.77">org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1084)</sentence>
            <sentence id="10.78">org.openmrs.module.web.filter.ModuleFilterChain.doFilter(ModuleFilterChain.java:76)</sentence>
            <sentence id="10.79">org.openmrs.module.web.filter.ModuleFilter.doFilter(ModuleFilter.java:58)</sentence>
            <sentence id="10.80">org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1084)</sentence>
            <sentence id="10.81">org.openmrs.web.filter.OpenmrsFilter.doFilterInternal(OpenmrsFilter.java:111)</sentence>
            <sentence id="10.82">org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)</sentence>
            <sentence id="10.83">org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1084)</sentence>
            <sentence id="10.84">org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:198)</sentence>
            <sentence id="10.85">org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)</sentence>
            <sentence id="10.86">org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1084)</sentence>
            <sentence id="10.87">org.openmrs.web.filter.StartupFilter.doFilter(StartupFilter.java:83)</sentence>
            <sentence id="10.88">org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1084)</sentence>
            <sentence id="10.89">org.openmrs.web.filter.StartupFilter.doFilter(StartupFilter.java:83)</sentence>
            <sentence id="10.90">org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1084)</sentence>
            <sentence id="10.91">org.openmrs.web.filter.StartupFilter.doFilter(StartupFilter.java:83)</sentence>
            <sentence id="10.92">org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1084)</sentence>
            <sentence id="10.93">org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:88)</sentence>
            <sentence id="10.94">org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)</sentence>
            <sentence id="10.95">org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1084)</sentence>
            <sentence id="10.96">org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:360)</sentence>
            <sentence id="10.97">org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)</sentence>
            <sentence id="10.98">org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181)</sentence>
            <sentence id="10.99">org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:726)</sentence>
            <sentence id="10.100">org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:405)</sentence>
            <sentence id="10.101">org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:206)</sentence>
            <sentence id="10.102">org.mortbay.jetty.handler.HandlerCollection.handle(HandlerCollection.java:114)</sentence>
            <sentence id="10.103">org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)</sentence>
            <sentence id="10.104">org.mortbay.jetty.Server.handle(Server.java:324)</sentence>
            <sentence id="10.105">org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:505)</sentence>
            <sentence id="10.106">org.mortbay.jetty.HttpConnection$RequestHandler.content(HttpConnection.java:843)</sentence>
            <sentence id="10.107">org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:648)</sentence>
            <sentence id="10.108">org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:211)</sentence>
            <sentence id="10.109">org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:380)</sentence>
            <sentence id="10.110">org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:395)</sentence>
            <sentence id="10.111">org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:488)</sentence>
        </paragraph>
        <paragraph id="11">
            <sentence id="11.1">OpenMRS Version: 1.9.0-SNAPSHOT</sentence>
        </paragraph>
    </description>
</bug>
