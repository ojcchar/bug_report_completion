<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
    <id>TRUNK-2761</id>
    <title>Cannot edit metadata for some forms</title>
    <description>
        <paragraph id="1">
            <sentence id="1.1">For some forms, when i select the form on the manage forms screen, i get an exception as per the stack trace below:</sentence>
        </paragraph>
        <paragraph id="2">
            <sentence id="2.1">{code}</sentence>
        </paragraph>
        <paragraph id="3">
            <sentence id="3.1">ERROR - errorhandler_jsp._jspService(72) |2011-10-17 14:16:01,214| Error on page /openmrs-1.9.0/errorhandler.jsp</sentence>
            <sentence id="3.2">javax.el.ELException: Error reading 'links' on type org.openmrs.module.xforms.extension.html.XformsFormHeaderExt</sentence>
            <sentence id="3.3">	at javax.el.BeanELResolver.getValue(BeanELResolver.java:66)</sentence>
            <sentence id="3.4">	at javax.el.CompositeELResolver.getValue(CompositeELResolver.java:54)</sentence>
            <sentence id="3.5">	at org.apache.el.parser.AstValue.getValue(AstValue.java:123)</sentence>
            <sentence id="3.6">	at org.apache.el.ValueExpressionImpl.getValue(ValueExpressionImpl.java:186)</sentence>
            <sentence id="3.7">	at org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate(PageContextImpl.java:935)</sentence>
            <sentence id="3.8">	at org.apache.jsp.WEB_002dINF.view.admin.forms.formEditForm_jsp._jspx_meth_c_005fforEach_005f4(formEditForm_jsp.java:5328)</sentence>
            <sentence id="3.9">	at org.apache.jsp.WEB_002dINF.view.admin.forms.formEditForm_jsp._jspx_meth_openmrs_005fextensionPoint_005f5(formEditForm_jsp.java:5298)</sentence>
            <sentence id="3.10">	at org.apache.jsp.WEB_002dINF.view.admin.forms.formEditForm_jsp._jspx_meth_c_005fif_005f24(formEditForm_jsp.java:5257)</sentence>
            <sentence id="3.11">	at org.apache.jsp.WEB_002dINF.view.admin.forms.formEditForm_jsp._jspx_meth_c_005fif_005f23(formEditForm_jsp.java:5197)</sentence>
            <sentence id="3.12">	at org.apache.jsp.WEB_002dINF.view.admin.forms.formEditForm_jsp._jspService(formEditForm_jsp.java:935)</sentence>
            <sentence id="3.13">	at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)</sentence>
            <sentence id="3.14">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)</sentence>
            <sentence id="3.15">	at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:377)</sentence>
            <sentence id="3.16">	at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:313)</sentence>
            <sentence id="3.17">	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:260)</sentence>
            <sentence id="3.18">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)</sentence>
            <sentence id="3.19">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)</sentence>
            <sentence id="3.20">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="3.21">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:70)</sentence>
            <sentence id="3.22">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="3.23">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="3.24">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:70)</sentence>
            <sentence id="3.25">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="3.26">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="3.27">	at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:646)</sentence>
            <sentence id="3.28">	at org.apache.catalina.core.ApplicationDispatcher.processRequest(ApplicationDispatcher.java:436)</sentence>
            <sentence id="3.29">	at org.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationDispatcher.java:374)</sentence>
            <sentence id="3.30">	at org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDispatcher.java:302)</sentence>
            <sentence id="3.31">	at org.springframework.web.servlet.view.InternalResourceView.renderMergedOutputModel(InternalResourceView.java:238)</sentence>
            <sentence id="3.32">	at org.springframework.web.servlet.view.AbstractView.render(AbstractView.java:250)</sentence>
            <sentence id="3.33">	at org.springframework.web.servlet.DispatcherServlet.render(DispatcherServlet.java:1047)</sentence>
            <sentence id="3.34">	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:817)</sentence>
            <sentence id="3.35">	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:719)</sentence>
            <sentence id="3.36">	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:644)</sentence>
            <sentence id="3.37">	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:549)</sentence>
            <sentence id="3.38">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:617)</sentence>
            <sentence id="3.39">	at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)</sentence>
            <sentence id="3.40">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)</sentence>
            <sentence id="3.41">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="3.42">	at org.openmrs.module.web.filter.ForcePasswordChangeFilter.doFilter(ForcePasswordChangeFilter.java:65)</sentence>
            <sentence id="3.43">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="3.44">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="3.45">	at org.openmrs.module.web.filter.ModuleFilterChain.doFilter(ModuleFilterChain.java:76)</sentence>
            <sentence id="3.46">	at org.openmrs.module.xforms.web.XformsFilter.doFilter(XformsFilter.java:60)</sentence>
            <sentence id="3.47">	at org.openmrs.module.web.filter.ModuleFilterChain.doFilter(ModuleFilterChain.java:74)</sentence>
            <sentence id="3.48">	at org.openmrs.module.web.filter.ModuleFilter.doFilter(ModuleFilter.java:58)</sentence>
            <sentence id="3.49">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="3.50">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="3.51">	at org.openmrs.web.filter.OpenmrsFilter.doFilterInternal(OpenmrsFilter.java:111)</sentence>
            <sentence id="3.52">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)</sentence>
            <sentence id="3.53">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="3.54">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="3.55">	at org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:198)</sentence>
            <sentence id="3.56">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)</sentence>
            <sentence id="3.57">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="3.58">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="3.59">	at org.openmrs.web.filter.StartupFilter.doFilter(StartupFilter.java:83)</sentence>
            <sentence id="3.60">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="3.61">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="3.62">	at org.openmrs.web.filter.StartupFilter.doFilter(StartupFilter.java:83)</sentence>
            <sentence id="3.63">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="3.64">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="3.65">	at org.openmrs.web.filter.StartupFilter.doFilter(StartupFilter.java:83)</sentence>
            <sentence id="3.66">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="3.67">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="3.68">	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:88)</sentence>
            <sentence id="3.69">	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)</sentence>
            <sentence id="3.70">	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)</sentence>
            <sentence id="3.71">	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)</sentence>
            <sentence id="3.72">	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)</sentence>
            <sentence id="3.73">	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)</sentence>
            <sentence id="3.74">	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)</sentence>
            <sentence id="3.75">	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)</sentence>
            <sentence id="3.76">	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)</sentence>
            <sentence id="3.77">	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)</sentence>
            <sentence id="3.78">	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:852)</sentence>
            <sentence id="3.79">	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:588)</sentence>
            <sentence id="3.80">	at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)</sentence>
            <sentence id="3.81">	at java.lang.Thread.run(Thread.java:680)</sentence>
            <sentence id="3.82">Caused by: java.lang.UnsupportedOperationException: XSLTs no longer exist on Forms. Use Form Attributes.</sentence>
            <sentence id="3.83">	at org.openmrs.Form.setXslt(Form.java:168)</sentence>
            <sentence id="3.84">	at org.openmrs.module.xforms.BasicFormBuilder.addDefaultFields(BasicFormBuilder.java:46)</sentence>
            <sentence id="3.85">	at org.openmrs.module.xforms.extension.html.XformsFormHeaderExt.getLinks(XformsFormHeaderExt.java:63)</sentence>
            <sentence id="3.86">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</sentence>
            <sentence id="3.87">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)</sentence>
            <sentence id="3.88">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)</sentence>
            <sentence id="3.89">	at java.lang.reflect.Method.invoke(Method.java:597)</sentence>
            <sentence id="3.90">	at javax.el.BeanELResolver.getValue(BeanELResolver.java:62)</sentence>
            <sentence id="3.91">	... 78 more</sentence>
        </paragraph>
        <paragraph id="4">
            <sentence id="4.1">{code}</sentence>
        </paragraph>
        <paragraph id="5">
            <sentence id="5.1">Since the form xslt and template were put back by Jeremy's revert, do we need to throw this exception any more?</sentence>
            <sentence id="5.2">Even if we still need to, wouldn't it be more appropriate to start by deprecating the Form.setXslt() method and then eventually remove it in later OpenMRS versions than what we do now of throwing the UnsupportedOperationException("XSLTs no longer exist on Forms.</sentence>
            <sentence id="5.3">Use Form Attributes.")</sentence>
        </paragraph>
    </description>
</bug>
