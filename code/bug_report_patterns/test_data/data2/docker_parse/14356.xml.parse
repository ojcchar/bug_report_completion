<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
    <id>14356</id>
    <title>Proxy within container only works with proxy ip, rather than hostname</title>
    <description>
        <paragraph id="1">
            <sentence id="1.1">Description of problem:
When behind a corporate proxy, http://proxy.company.com:8080/, I can set the
proxy variables for the docker daemon on my host machine.</sentence>
            <sentence id="1.2">However once in a
container, ubuntu:14.04, attempting to set the proxies with</sentence>
            <sentence id="1.3">"' bash
export http_proxy="http://proxy.company.com:8080/"
export https_proxy="http://proxy.company.com:8080/"
export HTTP_PROXY="http://proxy.company.com:8080/"
export HTTPS_PROXY="http://proxy.company.com:8080/"
"'</sentence>
            <sentence id="1.4">or when building a container with</sentence>
            <sentence id="1.5">"' Dockerfile
ENV http_proxy 'http://proxy.company.com:8080'
ENV https_proxy 'http://proxy.company.com:8080'
ENV HTTP_PROXY 'http://proxy.company.com:8080'
ENV HTTPS_PROXY 'http://proxy.company.com:8080'
"'</sentence>
            <sentence id="1.6">Does not work.</sentence>
            <sentence id="1.7">This is using the --net=host option with docker run.</sentence>
            <sentence id="1.8">I could not figure out how to give the build access to the host network.</sentence>
        </paragraph>
        <paragraph id="2">
            <sentence id="2.1">The trick I found was to ping proxy.company.com from my host and get the ip
then set the proxies from within my container like so.</sentence>
        </paragraph>
        <paragraph id="3">
            <sentence id="3.1">"' bash
ping proxy.company.com
PING proxy.company.com (12.34.567.898) 56(84) bytes of data.
^C</sentence>
        </paragraph>
        <paragraph id="4">
            <sentence id="4.1">docker run --net=host -t -i ubuntu:14.04 /bin/bash</sentence>
        </paragraph>
        <paragraph id="5">
            <sentence id="5.1">export http_proxy="http://12.34.567.898:8080/"
export https_proxy="http://12.34.567.898:8080/"
export HTTP_PROXY="http://12.34.567.898:8080/"
export HTTPS_PROXY="http://12.34.567.898:8080/"
"'</sentence>
        </paragraph>
        <paragraph id="6">
            <sentence id="6.1">'docker version':
Client version: 1.7.0
Client API version: 1.19
Go version (client): go1.4.2
Git commit (client): 0baf609
OS/Arch (client): linux/amd64
Server version: 1.7.0
Server API version: 1.19
Go version (server): go1.4.2
Git commit (server): 0baf609
OS/Arch (server): linux/amd64</sentence>
        </paragraph>
        <paragraph id="7">
            <sentence id="7.1">'docker info':
Containers: 11
Images: 26
Storage Driver: aufs
 Root Dir: /var/lib/docker/aufs
 Backing Filesystem: extfs
 Dirs: 48
 Dirperm1 Supported: false
Execution Driver: native-0.2
Logging Driver: json-file
Kernel Version: 3.13.0-55-generic
Operating System: Ubuntu 14.04.2 LTS
CPUs: 4
Total Memory: 5.718 GiB
Name: Graphics
ID: TFMJ:I23E:WUXS:ZF5X:5NJ5:CVHX:F2JN:XUH5:X7GD:EGLU:4IXQ:UPRP
Http Proxy: http://proxy.company.com:8080/
Https Proxy: http://proxy.company.com:8080/
Username: pdxjohnny
Registry: https://index.docker.io/v1/
WARNING: No swap limit support</sentence>
        </paragraph>
        <paragraph id="8">
            <sentence id="8.1">'uname -a':
Linux Graphics 3.13.0-55-generic #94-Ubuntu SMP Thu Jun 18 00:27:10 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux</sentence>
        </paragraph>
        <paragraph id="9">
            <sentence id="9.1">Environment details (AWS, VirtualBox, physical, etc.):
physical</sentence>
        </paragraph>
        <paragraph id="10">
            <sentence id="10.1">How reproducible:
Every time</sentence>
        </paragraph>
        <paragraph id="11">
            <sentence id="11.1">Steps to Reproduce:</sentence>
            <sentence id="11.2">1 Start container</sentence>
            <sentence id="11.3">2 Set proxies</sentence>
            <sentence id="11.4">3 apt-get / ping anything</sentence>
        </paragraph>
        <paragraph id="12">
            <sentence id="12.1">Actual Results:
apt-get says:
Can't resolve hostname proxy.company.com
when updating</sentence>
        </paragraph>
        <paragraph id="13">
            <sentence id="13.1">Expected Results / What would work best:
If it would resolve the hostname proxy.company.com and find the ip
of the proxy itself</sentence>
        </paragraph>
        <paragraph id="14">
            <sentence id="14.1">Additional info:</sentence>
        </paragraph>
    </description>
</bug>
