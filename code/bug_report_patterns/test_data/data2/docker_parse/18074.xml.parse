<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
    <id>18074</id>
    <title>Building a dynamic Docker binary on ARM fails when buildflags includes 'journald'</title>
    <description>
        <paragraph id="1">
            <sentence id="1.1">docker-version:</sentence>
        </paragraph>
        <paragraph id="2">
            <sentence id="2.1">"'
root@scw-04:~# docker version
Client:
 Version: 1.9.0
 API version: 1.21
 Go version: go1.4.3
 Git commit: 76d6bc9
 Built: Tue Nov 3 22:16:18 UTC 2015
 OS/Arch: linux/arm</sentence>
        </paragraph>
        <paragraph id="3">
            <sentence id="3.1">Server:
 Version: 1.9.0
 API version: 1.21
 Go version: go1.4.3
 Git commit: 76d6bc9
 Built: Tue Nov 3 22:16:18 UTC 2015
 OS/Arch: linux/arm
"'</sentence>
        </paragraph>
        <paragraph id="4">
            <sentence id="4.1">docker info:</sentence>
        </paragraph>
        <paragraph id="5">
            <sentence id="5.1">"'
root@scw-04:~# docker info
Containers: 2
Images: 86
Server Version: 1.9.0
Storage Driver: aufs
 Root Dir: /var/lib/docker/aufs
 Backing Filesystem: extfs
 Dirs: 90
 Dirperm1 Supported: true
Execution Driver: native-0.2
Logging Driver: json-file
Kernel Version: 4.2.5-263
Operating System: Ubuntu 15.10
CPUs: 4
Total Memory: 1.974 GiB
Name: scw-04
ID: Q6FW:URXH:E6ZF:QMY2:7GRD:7FMR:UE47:CFBO:FAXY:EKT4:TOUS:OXAX
Labels:
 provider=scaleway
"'</sentence>
        </paragraph>
        <paragraph id="6">
            <sentence id="6.1">uname -a:</sentence>
        </paragraph>
        <paragraph id="7">
            <sentence id="7.1">"'
root@scw-04:~# uname -a
Linux scw-04 4.2.5-263 #1 SMP Wed Nov 4 17:03:17 UTC 2015 armv7l armv7l armv7l GNU/Linux
"'</sentence>
        </paragraph>
        <paragraph id="8">
            <sentence id="8.1">List the steps to reproduce the issue:</sentence>
            <sentence id="8.2">1 Clone the current docker/docker repository on a Scaleway C1 ARM server</sentence>
            <sentence id="8.3">2 change into the docker repository root directory</sentence>
            <sentence id="8.4">3 run 'make build' to create the Docker Dev image</sentence>
            <sentence id="8.5">4 run 'docker run -ti --privileged docker-dev:HEAD bash'</sentence>
            <sentence id="8.6">5 run 'hack/make.</sentence>
            <sentence id="8.7">sh dynbinary'</sentence>
        </paragraph>
        <paragraph id="9">
            <sentence id="9.1">Describe the results you received:</sentence>
        </paragraph>
        <paragraph id="10">
            <sentence id="10.1">Running 'hack/make.sh dynbinary' fails with the following error:</sentence>
        </paragraph>
        <paragraph id="11">
            <sentence id="11.1">"'</sentence>
            <sentence id="11.2">/var/tmp/go-link-5uIpub/000007.o: In function '__gnu_uldivmod_helper':</sentence>
            <sentence id="11.3">:(.text+0x87b20): multiple definition of '__gnu_uldivmod_helper'</sentence>
            <sentence id="11.4">/var/tmp/go-link-5uIpub/000003.o::(.text+0x638): first defined here</sentence>
            <sentence id="11.5">/var/tmp/go-link-5uIpub/000007.o: In function '__divdi3':</sentence>
            <sentence id="11.6">:(.text+0x87b50): multiple definition of '__divdi3'</sentence>
            <sentence id="11.7">/var/tmp/go-link-5uIpub/000003.o::(.text+0x668): first defined here</sentence>
            <sentence id="11.8">/var/tmp/go-link-5uIpub/000007.o: In function '__aeabi_uldivmod':</sentence>
            <sentence id="11.9">:(.text+0x87a40): multiple definition of '__aeabi_uldivmod'</sentence>
            <sentence id="11.10">/var/tmp/go-link-5uIpub/000003.o::(.text+0x5cc): first defined here</sentence>
            <sentence id="11.11">/var/tmp/go-link-5uIpub/000007.o: In function '__aeabi_uidiv':</sentence>
            <sentence id="11.12">:(.text+0x87170): multiple definition of '__udivsi3'</sentence>
            <sentence id="11.13">/var/tmp/go-link-5uIpub/000003.o::(.text+0xcc0): first defined here</sentence>
            <sentence id="11.14">/var/tmp/go-link-5uIpub/000007.o: In function '__udivdi3':</sentence>
            <sentence id="11.15">:(.text+0x87eac): multiple definition of '__udivdi3'</sentence>
            <sentence id="11.16">/var/tmp/go-link-5uIpub/000003.o::(.text+0x9c4): first defined here</sentence>
            <sentence id="11.17">/var/tmp/go-link-5uIpub/000007.o: In function '__aeabi_uidiv':</sentence>
            <sentence id="11.18">:(.text+0x87170): multiple definition of '__aeabi_uidiv'</sentence>
            <sentence id="11.19">/var/tmp/go-link-5uIpub/000003.o::(.text+0xcc0): first defined here</sentence>
            <sentence id="11.20">/var/tmp/go-link-5uIpub/000007.o: In function '__aeabi_uidivmod':</sentence>
            <sentence id="11.21">:(.text+0x873cc): multiple definition of '__aeabi_uidivmod'</sentence>
            <sentence id="11.22">/var/tmp/go-link-5uIpub/000003.o::(.text+0xf1c): first defined here</sentence>
            <sentence id="11.23">/var/tmp/go-link-5uIpub/000007.o: In function '__gnu_ldivmod_helper':</sentence>
            <sentence id="11.24">:(.text+0x87af0): multiple definition of '__gnu_ldivmod_helper'</sentence>
            <sentence id="11.25">/var/tmp/go-link-5uIpub/000003.o::(.text+0x608): first defined here</sentence>
            <sentence id="11.26">collect2: error: ld returned 1 exit status</sentence>
            <sentence id="11.27">/usr/local/go/pkg/tool/linux_arm/5l: running gcc failed: unsuccessful exit status 0x100</sentence>
            <sentence id="11.28">"'</sentence>
        </paragraph>
        <paragraph id="12">
            <sentence id="12.1">Digging deeper this can be traced back to 
https://github.com/docker/docker/blob/master/hack/make/binary#L40</sentence>
        </paragraph>
        <paragraph id="13">
            <sentence id="13.1">After experimenting with the buildflags/tags in the 'go build' command it turns out that without the 'journald' flag it works.</sentence>
            <sentence id="13.2">Adding it triggers the above error.</sentence>
        </paragraph>
        <paragraph id="14">
            <sentence id="14.1">Describe the results you expected:
A dynamically build Docker binary in bundles/latest/*.</sentence>
            <sentence id="14.2">No error messages.</sentence>
        </paragraph>
        <paragraph id="15">
            <sentence id="15.1">**Any ideas/hints how this can be fixed?</sentence>
            <sentence id="15.2">**</sentence>
        </paragraph>
        <paragraph id="16">
            <sentence id="16.1">**Note**: This needs to be fixed as part of #17802.</sentence>
        </paragraph>
    </description>
</bug>
