<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
    <id>22581</id>
    <title>--iptables=false not working</title>
    <description>
        <paragraph id="1">
            <sentence id="1.1">&lt;!</sentence>
            <sentence id="1.2">--
If you are reporting a new issue, make sure that we do not have any duplicates
already open.</sentence>
            <sentence id="1.3">You can ensure this by searching the issue list for this
repository.</sentence>
            <sentence id="1.4">If there is a duplicate, please close your issue and add a comment
to the existing issue instead.</sentence>
        </paragraph>
        <paragraph id="2">
            <sentence id="2.1">If you suspect your issue is a bug, please edit your issue description to
include the BUG REPORT INFORMATION shown below.</sentence>
            <sentence id="2.2">If you fail to provide this
information within 7 days, we cannot debug your issue and will close it.</sentence>
            <sentence id="2.3">We
will, however, reopen it if you later provide the information.</sentence>
        </paragraph>
        <paragraph id="3">
            <sentence id="3.1">For more information about reporting issues, see
https://github.com/docker/docker/blob/master/CONTRIBUTING.md#reporting-other-issues</sentence>
        </paragraph>
        <paragraph id="4">
            <sentence id="4.1">---------------------------------------------------</sentence>
            <sentence id="4.2">BUG REPORT INFORMATION</sentence>
            <sentence id="4.3">---------------------------------------------------</sentence>
            <sentence id="4.4">Use the commands below to provide key information from your environment:</sentence>
            <sentence id="4.5">You do NOT have to include this information if this is a FEATURE REQUEST</sentence>
            <sentence id="4.6">--&gt;</sentence>
        </paragraph>
        <paragraph id="5">
            <sentence id="5.1">**Output of 'docker version':**</sentence>
        </paragraph>
        <paragraph id="6">
            <sentence id="6.1">"'
Client:
 Version: 1.11.1
 API version: 1.23
 Go version: go1.5.4
 Git commit: 5604cbe
 Built: Tue Apr 26 23:43:49 2016
 OS/Arch: linux/amd64</sentence>
        </paragraph>
        <paragraph id="7">
            <sentence id="7.1">Server:
 Version: 1.11.1
 API version: 1.23
 Go version: go1.5.4
 Git commit: 5604cbe
 Built: Tue Apr 26 23:43:49 2016
 OS/Arch: linux/amd64</sentence>
        </paragraph>
        <paragraph id="8">
            <sentence id="8.1">"'</sentence>
        </paragraph>
        <paragraph id="9">
            <sentence id="9.1">**Output of 'docker info':**</sentence>
        </paragraph>
        <paragraph id="10">
            <sentence id="10.1">"'</sentence>
            <sentence id="10.2">Containers: 1</sentence>
            <sentence id="10.3"> Running: 0</sentence>
            <sentence id="10.4"> Paused: 0</sentence>
            <sentence id="10.5"> Stopped: 1</sentence>
            <sentence id="10.6">Images: 1</sentence>
            <sentence id="10.7">Server Version: 1.11.1</sentence>
            <sentence id="10.8">Storage Driver: devicemapper</sentence>
            <sentence id="10.9"> Pool Name: docker-253:1-922025-pool</sentence>
            <sentence id="10.10"> Pool Blocksize: 65.54 kB</sentence>
            <sentence id="10.11"> Base Device Size: 10.74 GB</sentence>
            <sentence id="10.12"> Backing Filesystem: xfs</sentence>
            <sentence id="10.13"> Data file: /dev/loop0</sentence>
            <sentence id="10.14"> Metadata file: /dev/loop1</sentence>
            <sentence id="10.15"> Data Space Used: 260 MB</sentence>
            <sentence id="10.16"> Data Space Total: 107.4 GB</sentence>
            <sentence id="10.17"> Data Space Available: 18.99 GB</sentence>
            <sentence id="10.18"> Metadata Space Used: 942.1 kB</sentence>
            <sentence id="10.19"> Metadata Space Total: 2.147 GB</sentence>
            <sentence id="10.20"> Metadata Space Available: 2.147 GB</sentence>
            <sentence id="10.21"> Udev Sync Supported: true</sentence>
            <sentence id="10.22"> Deferred Removal Enabled: false</sentence>
            <sentence id="10.23"> Deferred Deletion Enabled: false</sentence>
            <sentence id="10.24"> Deferred Deleted Device Count: 0</sentence>
            <sentence id="10.25"> Data loop file: /var/lib/docker/devicemapper/devicemapper/data</sentence>
            <sentence id="10.26"> WARNING: Usage of loopback devices is strongly discouraged for production use. Either use '--storage-opt dm.thinpooldev' or use '--storage-opt dm.no_warn_on_loop_devices=true' to suppress this warning.</sentence>
            <sentence id="10.27"> Metadata loop file: /var/lib/docker/devicemapper/devicemapper/metadata</sentence>
            <sentence id="10.28"> Library Version: 1.02.110 (2015-10-30)</sentence>
            <sentence id="10.29">Logging Driver: json-file</sentence>
            <sentence id="10.30">Cgroup Driver: cgroupfs</sentence>
            <sentence id="10.31">Plugins:</sentence>
            <sentence id="10.32"> Volume: local</sentence>
            <sentence id="10.33"> Network: bridge null host</sentence>
            <sentence id="10.34">Kernel Version: 4.4.0-22-generic</sentence>
            <sentence id="10.35">Operating System: Ubuntu 16.04 LTS</sentence>
            <sentence id="10.36">OSType: linux</sentence>
            <sentence id="10.37">Architecture: x86_64</sentence>
            <sentence id="10.38">CPUs: 1</sentence>
            <sentence id="10.39">Total Memory: 488.6 MiB</sentence>
            <sentence id="10.40">Name: magus-gateway</sentence>
            <sentence id="10.41">ID: ZJQB:RBPF:SBEF:FFFP:J2HP:3TXD:SGUW:MFWJ:LUWJ:OMQG:WFYD:CKQ6</sentence>
            <sentence id="10.42">Docker Root Dir: /var/lib/docker</sentence>
            <sentence id="10.43">Debug mode (client): false</sentence>
            <sentence id="10.44">Debug mode (server): false</sentence>
            <sentence id="10.45">Registry: https://index.docker.io/v1/</sentence>
            <sentence id="10.46">WARNING: No swap limit support</sentence>
        </paragraph>
        <paragraph id="11">
            <sentence id="11.1">**Additional environment details (AWS, VirtualBox, physical, etc.):**</sentence>
        </paragraph>
        <paragraph id="12">
            <sentence id="12.1">Running on Digital Ocean Ubuntu 16.04 image</sentence>
        </paragraph>
        <paragraph id="13">
            <sentence id="13.1">**Steps to reproduce the issue:**</sentence>
            <sentence id="13.2">1 Configure DOCKER_OPTS="--iptables=false"</sentence>
            <sentence id="13.3">2 Clear out all iptables rules/chains "iptables -F, iptables -X"</sentence>
            <sentence id="13.4">3 Empty out everything in /etc/iptables/rules.</sentence>
            <sentence id="13.5">v4 and /etc/iptables/rules.</sentence>
            <sentence id="13.6">v6 except commit</sentence>
            <sentence id="13.7">4 Restart system</sentence>
        </paragraph>
        <paragraph id="14">
            <sentence id="14.1">**Describe the results you received:**</sentence>
        </paragraph>
        <paragraph id="15">
            <sentence id="15.1">Docker rules are still being repopulated in iptables.</sentence>
            <sentence id="15.2">Docker is also modifying iptables when I expose ports, the rules it adds are too permissive.</sentence>
        </paragraph>
        <paragraph id="16">
            <sentence id="16.1">**Describe the results you expected:**</sentence>
        </paragraph>
        <paragraph id="17">
            <sentence id="17.1">Docker is supposed to stop modifying iptables as per the documentation</sentence>
        </paragraph>
        <paragraph id="18">
            <sentence id="18.1">**Additional information you deem important (e.g. issue happens only occasionally):**</sentence>
            <sentence id="18.2">"'</sentence>
        </paragraph>
    </description>
</bug>
