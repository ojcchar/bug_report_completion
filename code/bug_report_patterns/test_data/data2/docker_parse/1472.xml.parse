<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
    <id>1472</id>
    <title>Bug: writev() fails when using AUFS on ZFS (possibly Ubuntu-specific)</title>
    <description>
        <paragraph id="1">
            <sentence id="1.1">If '/var/lib/docker' is mounted on a ZFS file system then the writev() system call fails.</sentence>
            <sentence id="1.2">This causes NGiNX to return 500 errors when processing a body that needs to be buffered to disk.</sentence>
            <sentence id="1.3">I'm not sure if this is a Docker, AUFS, or ZFS bug.</sentence>
        </paragraph>
        <paragraph id="2">
            <sentence id="2.1">Steps to reproduce:</sentence>
            <sentence id="2.2">1 Stop the docker daemon</sentence>
            <sentence id="2.3">"'</sentence>
            <sentence id="2.4">sudo service docker stop</sentence>
            <sentence id="2.5">"'</sentence>
            <sentence id="2.6">2 Create a ZFS file system</sentence>
            <sentence id="2.7">"'</sentence>
            <sentence id="2.8">sudo zfs create -o mountpoint=/var/lib/docker rpool/docker</sentence>
            <sentence id="2.9">"'</sentence>
            <sentence id="2.10">3 Restart the Docker daemon</sentence>
            <sentence id="2.11">"'</sentence>
            <sentence id="2.12">sudo service docker start</sentence>
            <sentence id="2.13">"'</sentence>
            <sentence id="2.14">4 Run the test container</sentence>
            <sentence id="2.15">"'</sentence>
            <sentence id="2.16">docker run ismell/wvtest</sentence>
            <sentence id="2.17">"'</sentence>
            <sentence id="2.18">5 Notice explosion</sentence>
            <sentence id="2.19">!</sentence>
            <sentence id="2.20">[Boom](http://images.wikia.com/fallout/images/d/d7/Nuclear_explosion.jpg)</sentence>
            <sentence id="2.21">6 Stop Docker</sentence>
            <sentence id="2.22">"'</sentence>
            <sentence id="2.23">sudo service docker stop</sentence>
            <sentence id="2.24">"'</sentence>
            <sentence id="2.25">7 Revert your store</sentence>
            <sentence id="2.26">"'</sentence>
            <sentence id="2.27">sudo zfs destroy rpool/docker</sentence>
            <sentence id="2.28">"'</sentence>
            <sentence id="2.29">8 Restart the Docker daemon</sentence>
            <sentence id="2.30">"'</sentence>
            <sentence id="2.31">sudo service docker start</sentence>
            <sentence id="2.32">"'</sentence>
        </paragraph>
        <paragraph id="3">
            <sentence id="3.1">My test container contains a compiled version of @jpetazzo's wvtest.c.</sentence>
            <sentence id="3.2">You can find the source here: https://gist.github.com/jpetazzo/6160048</sentence>
        </paragraph>
    </description>
</bug>
