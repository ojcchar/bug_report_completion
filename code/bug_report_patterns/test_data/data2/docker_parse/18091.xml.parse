<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
    <id>18091</id>
    <title>container with unless-stopped restart policy is not restarted when the overlay network is not yet available1.12.0</title>
    <description>
        <paragraph id="1">
            <sentence id="1.1">There seems to be an issue when restarting a container with unless-stopped and an overlay network. (see the inspect error ' "Error": "network v7 not found",' )</sentence>
            <sentence id="1.2">Here is my env and steps to reproduce:</sentence>
            <sentence id="1.3"> $ sudo docker info</sentence>
            <sentence id="1.4">Containers: 24</sentence>
            <sentence id="1.5">Images: 302</sentence>
            <sentence id="1.6">Server Version: 1.9.0</sentence>
            <sentence id="1.7">Storage Driver: overlay</sentence>
            <sentence id="1.8"> Backing Filesystem: extfs</sentence>
            <sentence id="1.9">Execution Driver: native-0.2</sentence>
            <sentence id="1.10">Logging Driver: json-file</sentence>
            <sentence id="1.11">Kernel Version: 4.3.0-040300-generic</sentence>
            <sentence id="1.12">Operating System: Ubuntu 14.04.3 LTS</sentence>
            <sentence id="1.13">CPUs: 8</sentence>
            <sentence id="1.14">Total Memory: 15.16 GiB</sentence>
            <sentence id="1.15">Name: sebi</sentence>
            <sentence id="1.16">ID: G3MJ:2URQ:P7DQ:5Z4W:GAW4:RYKP:U23J:NPER:IFEQ:XLFB:QX77:H3VA</sentence>
            <sentence id="1.17">Registry: https://index.docker.io/v1/</sentence>
            <sentence id="1.18">WARNING: No swap limit support</sentence>
            <sentence id="1.19">Cluster store: consul://localhost:8500</sentence>
            <sentence id="1.20">Cluster advertise: 192.168.77.233:2375</sentence>
        </paragraph>
        <paragraph id="2">
            <sentence id="2.1">$ sudo docker version
Client:
 Version: 1.9.0
 API version: 1.21
 Go version: go1.4.2
 Git commit: 76d6bc9
 Built: Tue Nov 3 17:43:42 UTC 2015
 OS/Arch: linux/amd64</sentence>
        </paragraph>
        <paragraph id="3">
            <sentence id="3.1">Server:
 Version: 1.9.0
 API version: 1.21
 Go version: go1.4.2
 Git commit: 76d6bc9
 Built: Tue Nov 3 17:43:42 UTC 2015
 OS/Arch: linux/amd64</sentence>
        </paragraph>
        <paragraph id="4">
            <sentence id="4.1">$ uname -a
Linux sebi 4.3.0-040300-generic #201511020949 SMP Mon Nov 2 14:50:44 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux</sentence>
        </paragraph>
        <paragraph id="5">
            <sentence id="5.1">$ sudo docker ps
CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
1265e5a72ba8 swarm:1.0.0 "/swarm manage --host" 3 days ago Up 34 minutes swarm-manager
3e68afe02fce swarm:1.0.0 "/swarm join --addr=l" 3 days ago Up 34 minutes swarm-agent
bdfb83da6312 48ea159bfe73 "/bin/sh -c 'sudo dns" 3 days ago Up 34 minutes dnsmasq
60f63d5d58be 195324010cf2 ".</sentence>
            <sentence id="5.2">/start.sh" 3 days ago Up 34 minutes consul-server</sentence>
        </paragraph>
        <paragraph id="6">
            <sentence id="6.1">$ sudo docker network ls
NETWORK ID NAME DRIVER
1e8d37cfbdc6 v7 overlay 
d352bb53614d es overlay 
0df6681e5e8b docker_gwbridge bridge 
9430df44358f test bridge 
c7bc60c709f2 bridge bridge 
70adb2539cf5 none null 
f46bb02ef887 host host</sentence>
        </paragraph>
        <paragraph id="7">
            <sentence id="7.1">$ sudo docker run -tid --restart="unless-stopped" --net="v7" ubuntu bash 
96108449ddd584567314878b09885014012e21d9107dd21da791a2fa1a4b2f19</sentence>
        </paragraph>
        <paragraph id="8">
            <sentence id="8.1">$ sudo docker ps
CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
96108449ddd5 ubuntu "bash" 10 seconds ago Up 10 seconds evil_noyce
1265e5a72ba8 swarm:1.0.0 "/swarm manage --host" 3 days ago Up 36 minutes swarm-manager
3e68afe02fce swarm:1.0.0 "/swarm join --addr=l" 3 days ago Up 36 minutes swarm-agent
bdfb83da6312 48ea159bfe73 "/bin/sh -c 'sudo dns" 3 days ago Up 36 minutes dnsmasq
60f63d5d58be 195324010cf2 ".</sentence>
            <sentence id="8.2">/start.sh" 3 days ago Up 36 minutes consul-server</sentence>
        </paragraph>
        <paragraph id="9">
            <sentence id="9.1">$ ps -aef|grep docker\ daemon
adminis+ 3623 1 1 17:01 ?</sentence>
            <sentence id="9.2">00:00:43 /usr/bin/docker daemon --userland-proxy=false --cluster-advertise=eth0:2375 --cluster-store consul://localhost:8500 -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.</sentence>
            <sentence id="9.3">sock --bip=172.17.42.1/16 --dns 8.8.8.8 --dns 8.8.4.4 -s overlay
seb 22117 3020 0 17:38 pts/26 00:00:00 grep --color=auto docker daemon</sentence>
        </paragraph>
        <paragraph id="10">
            <sentence id="10.1">$ sudo kill -9 3623</sentence>
        </paragraph>
        <paragraph id="11">
            <sentence id="11.1">$ sudo docker ps
CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
1265e5a72ba8 swarm:1.0.0 "/swarm manage --host" 3 days ago Up 8 seconds swarm-manager
3e68afe02fce swarm:1.0.0 "/swarm join --addr=l" 3 days ago Up 8 seconds swarm-agent
bdfb83da6312 48ea159bfe73 "/bin/sh -c 'sudo dns" 3 days ago Up 8 seconds dnsmasq
60f63d5d58be 195324010cf2 ".</sentence>
            <sentence id="11.2">/start.sh" 3 days ago Up 8 seconds consul-server</sentence>
        </paragraph>
        <paragraph id="12">
            <sentence id="12.1">$ sudo docker network ls
NETWORK ID NAME DRIVER
1e8d37cfbdc6 v7 overlay 
d352bb53614d es overlay 
fcb31a4013e6 host host 
0df6681e5e8b docker_gwbridge bridge 
9430df44358f test bridge 
eff2051a90e9 bridge bridge 
d08eb8a89060 none null</sentence>
        </paragraph>
        <paragraph id="13">
            <sentence id="13.1">$ sudo docker inspect evil_noyce
[
{
 "Id": "96108449ddd584567314878b09885014012e21d9107dd21da791a2fa1a4b2f19",
 "Created": "2015-11-19T15:37:40.251001258Z",
 "Path": "bash",
 "Args": [],
 "State": {
 "Status": "exited",
 "Running": false,
 "Paused": false,
 "Restarting": false,
 "OOMKilled": false,
 "Dead": false,
 "Pid": 0,
 "ExitCode": 137,
 "Error": "network v7 not found",
 "StartedAt": "2015-11-19T15:37:40.799663568Z",
 "FinishedAt": "2015-11-19T15:38:47.407391317Z"
 },</sentence>
        </paragraph>
    </description>
</bug>
