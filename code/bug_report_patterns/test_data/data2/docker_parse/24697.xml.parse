<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
    <id>24697</id>
    <title>Docker run works behind proxy, and Docker build does not</title>
    <description>
        <paragraph id="1">
            <sentence id="1.1">&lt;!</sentence>
            <sentence id="1.2">--
If you are reporting a new issue, make sure that we do not have any duplicates
already open.</sentence>
            <sentence id="1.3">You can ensure this by searching the issue list for this
repository.</sentence>
            <sentence id="1.4">If there is a duplicate, please close your issue and add a comment
to the existing issue instead.</sentence>
        </paragraph>
        <paragraph id="2">
            <sentence id="2.1">If you suspect your issue is a bug, please edit your issue description to
include the BUG REPORT INFORMATION shown below.</sentence>
            <sentence id="2.2">If you fail to provide this
information within 7 days, we cannot debug your issue and will close it.</sentence>
            <sentence id="2.3">We
will, however, reopen it if you later provide the information.</sentence>
        </paragraph>
        <paragraph id="3">
            <sentence id="3.1">For more information about reporting issues, see
https://github.com/docker/docker/blob/master/CONTRIBUTING.md#reporting-other-issues</sentence>
        </paragraph>
        <paragraph id="4">
            <sentence id="4.1">---------------------------------------------------</sentence>
            <sentence id="4.2">BUG REPORT INFORMATION</sentence>
            <sentence id="4.3">---------------------------------------------------</sentence>
            <sentence id="4.4">Use the commands below to provide key information from your environment:</sentence>
            <sentence id="4.5">You do NOT have to include this information if this is a FEATURE REQUEST</sentence>
            <sentence id="4.6">--&gt;</sentence>
        </paragraph>
        <paragraph id="5">
            <sentence id="5.1">**Output of 'docker version':**</sentence>
        </paragraph>
        <paragraph id="6">
            <sentence id="6.1">"'
Client:
 Version: 1.12.0-rc4
 API version: 1.24
 Go version: go1.6.2
 Git commit: e4a0dbc
 Built: Wed Jul 13 03:28:51 2016
 OS/Arch: windows/amd64
 Experimental: true</sentence>
        </paragraph>
        <paragraph id="7">
            <sentence id="7.1">Server:
 Version: 1.12.0-rc4
 API version: 1.24
 Go version: go1.6.2
 Git commit: e4a0dbc
 Built: Wed Jul 13 03:28:51 2016
 OS/Arch: linux/amd64
 Experimental: true
"'</sentence>
        </paragraph>
        <paragraph id="8">
            <sentence id="8.1">**Output of 'docker info':**</sentence>
        </paragraph>
        <paragraph id="9">
            <sentence id="9.1">"'</sentence>
            <sentence id="9.2">Containers: 14</sentence>
            <sentence id="9.3"> Running: 0</sentence>
            <sentence id="9.4"> Paused: 0</sentence>
            <sentence id="9.5"> Stopped: 14</sentence>
            <sentence id="9.6">Images: 11</sentence>
            <sentence id="9.7">Server Version: 1.12.0-rc4</sentence>
            <sentence id="9.8">Storage Driver: aufs</sentence>
            <sentence id="9.9"> Root Dir: /var/lib/docker/aufs</sentence>
            <sentence id="9.10"> Backing Filesystem: extfs</sentence>
            <sentence id="9.11"> Dirs: 55</sentence>
            <sentence id="9.12"> Dirperm1 Supported: true</sentence>
            <sentence id="9.13">Logging Driver: json-file</sentence>
            <sentence id="9.14">Cgroup Driver: cgroupfs</sentence>
            <sentence id="9.15">Plugins:</sentence>
            <sentence id="9.16"> Volume: local</sentence>
            <sentence id="9.17"> Network: bridge host null overlay</sentence>
            <sentence id="9.18">Swarm: inactive</sentence>
            <sentence id="9.19">Runtimes: runc</sentence>
            <sentence id="9.20">Default Runtime: runc</sentence>
            <sentence id="9.21">Security Options: seccomp</sentence>
            <sentence id="9.22">Kernel Version: 4.4.15-moby</sentence>
            <sentence id="9.23">Operating System: Alpine Linux v3.4</sentence>
            <sentence id="9.24">OSType: linux</sentence>
            <sentence id="9.25">Architecture: x86_64</sentence>
            <sentence id="9.26">CPUs: 2</sentence>
            <sentence id="9.27">Total Memory: 1.459 GiB</sentence>
            <sentence id="9.28">Name: moby</sentence>
            <sentence id="9.29">ID: 6NAS:3AQW:EXQJ:5S6Y:OHL7:6V2Y:IKMK:ZDI6:7BSA:QO7E:3L7S:EEEG</sentence>
            <sentence id="9.30">Docker Root Dir: /var/lib/docker</sentence>
            <sentence id="9.31">Debug Mode (client): false</sentence>
            <sentence id="9.32">Debug Mode (server): false</sentence>
            <sentence id="9.33">Http Proxy: 10.0.75.1:7777</sentence>
            <sentence id="9.34">Https Proxy: 10.0.75.1:7777</sentence>
            <sentence id="9.35">Registry: https://index.docker.io/v1/</sentence>
            <sentence id="9.36">Experimental: true</sentence>
            <sentence id="9.37">Insecure Registries:</sentence>
            <sentence id="9.38"> 127.0.0.0/8</sentence>
            <sentence id="9.39">"'</sentence>
        </paragraph>
        <paragraph id="10">
            <sentence id="10.1">**Additional environment details (AWS, VirtualBox, physical, etc.):**</sentence>
        </paragraph>
        <paragraph id="11">
            <sentence id="11.1">Windows 10 Pro - Hyper-V
Dell Latitude 3540</sentence>
        </paragraph>
        <paragraph id="12">
            <sentence id="12.1">**Steps to reproduce the issue:**</sentence>
            <sentence id="12.2">1 docker run -it ruby bash</sentence>
            <sentence id="12.3">2 Configure http_proxy and https_proxy env variables</sentence>
            <sentence id="12.4">3 execute apt-get update (it should run fine)</sentence>
        </paragraph>
        <paragraph id="13">
            <sentence id="13.1">part that don't work</sentence>
            <sentence id="13.2">4 create a Dockerfile with this content</sentence>
        </paragraph>
        <paragraph id="14">
            <sentence id="14.1">"'
FROM ruby:latest
RUN apt-get update -qq &amp;&amp; apt-get install -y build-essential libmysqlclient-dev nodejs</sentence>
        </paragraph>
        <paragraph id="15">
            <sentence id="15.1">"'</sentence>
            <sentence id="15.2">1 docker build .</sentence>
        </paragraph>
        <paragraph id="16">
            <sentence id="16.1">**Describe the results you received:**</sentence>
        </paragraph>
        <paragraph id="17">
            <sentence id="17.1">"'</sentence>
            <sentence id="17.2">Sending build context to Docker daemon 2.048 kB</sentence>
            <sentence id="17.3">Step 1 : FROM ruby:latest</sentence>
            <sentence id="17.4">---&gt; e4b689e9dc8b</sentence>
            <sentence id="17.5">Step 2 : MAINTAINER Juliano Nunes</sentence>
            <sentence id="17.6">---&gt; Using cache</sentence>
            <sentence id="17.7">---&gt; 28ba78d36e99</sentence>
            <sentence id="17.8">Step 3 : RUN apt-get update -qq &amp;&amp; apt-get install -y build-essential libmysqlclient-dev nodejs</sentence>
            <sentence id="17.9">---&gt; Running in 9d1f43f218e9</sentence>
            <sentence id="17.10">W: Failed to fetch http://httpredir.debian.org/debian/dists/jessie/InRelease</sentence>
        </paragraph>
        <paragraph id="18">
            <sentence id="18.1">W: Failed to fetch http://httpredir.debian.org/debian/dists/jessie-updates/InRelease</sentence>
        </paragraph>
        <paragraph id="19">
            <sentence id="19.1">W: Failed to fetch http://security.debian.org/dists/jessie/updates/InRelease</sentence>
        </paragraph>
        <paragraph id="20">
            <sentence id="20.1">W: Failed to fetch http://security.debian.org/dists/jessie/updates/Release.gpg Could not resolve 'security.debian.org'</sentence>
        </paragraph>
        <paragraph id="21">
            <sentence id="21.1">W: Failed to fetch http://httpredir.debian.org/debian/dists/jessie/Release.gpg Could not resolve 'httpredir.debian.org'</sentence>
        </paragraph>
        <paragraph id="22">
            <sentence id="22.1">W: Failed to fetch http://httpredir.debian.org/debian/dists/jessie-updates/Release.gpg Could not resolve 'httpredir.deb
ian.org'</sentence>
        </paragraph>
        <paragraph id="23">
            <sentence id="23.1">W: Some index files failed to download.</sentence>
            <sentence id="23.2">They have been ignored, or old ones used instead.</sentence>
            <sentence id="23.3">Reading package lists...
Building dependency tree...
Reading state information...
E: Unable to locate package build-essential
E: Unable to locate package nodejs
The command '/bin/sh -c apt-get update -qq &amp;&amp; apt-get install -y build-essential libmysqlclient-dev nodejs' returned a
non-zero code: 100
"'</sentence>
        </paragraph>
        <paragraph id="24">
            <sentence id="24.1">**Describe the results you expected:**</sentence>
        </paragraph>
        <paragraph id="25">
            <sentence id="25.1">It should run apt-get update/install and build the image.</sentence>
        </paragraph>
        <paragraph id="26">
            <sentence id="26.1">**Additional information you deem important (e.g. issue happens only occasionally):**</sentence>
            <sentence id="26.2">- I have set in my Windows host the environment variables HTTP_PROXY and HTTPS_PROXY to make tools like GIT work behind a proxy.</sentence>
            <sentence id="26.3">- My company uses a proxy with NTLM authentication, then I use Fiddler as a tunnel (Internet Options is set to use 127.0.0.1:7777 as the proxy)</sentence>
        </paragraph>
    </description>
</bug>
