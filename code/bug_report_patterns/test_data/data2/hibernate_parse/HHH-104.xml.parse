<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
    <id>HHH-104</id>
    <title>problems with discriminator types other than string</title>
    <description>
        <paragraph id="1">
            <sentence id="1.1">The mapping file used was the following:</sentence>
            <sentence id="1.2">&lt;?xml version="1.0"?&gt;</sentence>
            <sentence id="1.3">&lt;!DOCTYPE hibernate-mapping SYSTEM "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd" &gt;</sentence>
        </paragraph>
        <paragraph id="2">
            <sentence id="2.1">&lt;!-- DO NOT EDIT: This is a generated file that is synchronized --&gt;</sentence>
            <sentence id="2.2">&lt;!-- by MyEclipse Hibernate tool integration. --&gt;</sentence>
            <sentence id="2.3">&lt;!-- Created Mon Nov 08 12:37:06 GMT-05:00 2004 --&gt;</sentence>
            <sentence id="2.4">&lt;hibernate-mapping package="ospoint.hibernate"&gt;</sentence>
        </paragraph>
        <paragraph id="3">
            <sentence id="3.1">&lt;class name="CustLink" table="CUST_LINK"&gt;</sentence>
            <sentence id="3.2">&lt;composite-id&gt;</sentence>
            <sentence id="3.3">&lt;key-property name="templId" column="TEMPL_ID"</sentence>
            <sentence id="3.4">type="java.lang.Long" /&gt;</sentence>
            <sentence id="3.5">&lt;!</sentence>
            <sentence id="3.6">-- 	&lt;key-property name="custLinkId" column="CUST_LINK_ID"</sentence>
            <sentence id="3.7">type="java.lang.Long" /&gt; --&gt;</sentence>
            <sentence id="3.8">&lt;key-many-to-one name="form" column="FORM_ID"</sentence>
            <sentence id="3.9">class="ospoint.hibernate.Form" /&gt;</sentence>
            <sentence id="3.10">&lt;key-many-to-one name="level" column="cust_level_type_id"</sentence>
            <sentence id="3.11">class="ospoint.hibernate.CustLevel" /&gt;</sentence>
            <sentence id="3.12">&lt;/composite-id&gt;</sentence>
        </paragraph>
        <paragraph id="4">
            <sentence id="4.1">&lt;discriminator formula="cust_level_type_id" type="integer" /&gt;</sentence>
        </paragraph>
        <paragraph id="5">
            <sentence id="5.1">&lt;many-to-one name="study" column="STUDY_ID"
			class="ospoint.hibernate.Study" /&gt;</sentence>
        </paragraph>
        <paragraph id="6">
            <sentence id="6.1">&lt;property name="auditInfo"
			type="com.osi.model.general.AuditInfoType"&gt;
			&lt;column name="CREATED_DT" /&gt;
			&lt;column name="CREATED_BY" /&gt;
			&lt;column name="UPDATED_DT" /&gt;
			&lt;column name="UPDATED_BY" /&gt;
		&lt;/property&gt;</sentence>
        </paragraph>
        <paragraph id="7">
            <sentence id="7.1">&lt;property name="status" column="CUSTLINK_STATUS"
			type="java.lang.String" not-null="true" /&gt;</sentence>
        </paragraph>
        <paragraph id="8">
            <sentence id="8.1">&lt;subclass name="CustLinkPhysician" discriminator-value="1"&gt;
			&lt;many-to-one name="physician" column="CUST_LINK_ID"
				class="ospoint.hibernate.Physician" /&gt;
		&lt;/subclass&gt;</sentence>
        </paragraph>
        <paragraph id="9">
            <sentence id="9.1">&lt;subclass name="CustLinkSite" discriminator-value="2"&gt;
			&lt;many-to-one name="site" column="CUST_LINK_ID"
				class="ospoint.hibernate.Site" /&gt;
		&lt;/subclass&gt;</sentence>
        </paragraph>
        <paragraph id="10">
            <sentence id="10.1">&lt;/class&gt;</sentence>
        </paragraph>
        <paragraph id="11">
            <sentence id="11.1">&lt;/hibernate-mapping&gt;</sentence>
        </paragraph>
        <paragraph id="12">
            <sentence id="12.1">When the discriminator is set to type="string" everything works fine, but when it changed, it fails.</sentence>
            <sentence id="12.2">The problem is that the code asks base classes for a discriminator value, which is set the fully qualified name of the base class.</sentence>
            <sentence id="12.3">In this case, it tries to cast the string "ospoint.hibernate.CustLink" to an integer which fails. </sentence>
            <sentence id="12.4">The exception is:</sentence>
            <sentence id="12.5">Caused by: java.lang.NumberFormatException: For input string: "ospoint.hibernate.CustLink"</sentence>
            <sentence id="12.6">	at java.lang.NumberFormatException.forInputString(NumberFormatException.java:48)</sentence>
            <sentence id="12.7">	at java.lang.Integer.parseInt(Integer.java:468)</sentence>
            <sentence id="12.8">	at java.lang.Integer.&lt;init&gt;(Integer.java:609)</sentence>
            <sentence id="12.9">	at org.hibernate.type.IntegerType.stringToObject(IntegerType.java:53)</sentence>
            <sentence id="12.10">	at org.hibernate.persister.SingleTableEntityPersister.&lt;init&gt;(SingleTableEntityPersister.java:253)</sentence>
            <sentence id="12.11">	... 27 more</sentence>
        </paragraph>
    </description>
</bug>
