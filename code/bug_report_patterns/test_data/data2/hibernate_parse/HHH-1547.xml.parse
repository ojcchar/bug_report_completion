<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
    <id>HHH-1547</id>
    <title>Query syntax error using IdentifierProjection.toSqlString()</title>
    <description>
        <paragraph id="1">
            <sentence id="1.1">While using IdentifierProjection.toSqlString() with a composite id, I got above wrong SQL syntax because of a bug.</sentence>
            <sentence id="1.2">I modified the source of hibernate as follows:</sentence>
            <sentence id="1.3">Original:</sentence>
            <sentence id="1.4">------------------------------------------------------</sentence>
            <sentence id="1.5">package org.hibernate.criterion;</sentence>
            <sentence id="1.6">...</sentence>
            <sentence id="1.7">public class IdentifierProjection extends SimpleProjection {</sentence>
            <sentence id="1.8">...</sentence>
            <sentence id="1.9">public String toSqlString(Criteria criteria, int position, CriteriaQuery criteriaQuery)</sentence>
            <sentence id="1.10">throws HibernateException {</sentence>
            <sentence id="1.11">StringBuffer buf = new StringBuffer();</sentence>
            <sentence id="1.12">String[] cols = criteriaQuery.getIdentifierColumns(criteria);</sentence>
            <sentence id="1.13">for ( int i=0; i&lt;cols.length; i++ ) {</sentence>
            <sentence id="1.14">buf.append( cols[i] )</sentence>
            <sentence id="1.15">.</sentence>
            <sentence id="1.16">append(" as y")</sentence>
            <sentence id="1.17">.</sentence>
            <sentence id="1.18">append(position + i)</sentence>
            <sentence id="1.19">.</sentence>
            <sentence id="1.20">append("_");</sentence>
            <sentence id="1.21">}</sentence>
            <sentence id="1.22">return buf.toString();</sentence>
            <sentence id="1.23">}</sentence>
        </paragraph>
        <paragraph id="2">
            <sentence id="2.1">}</sentence>
        </paragraph>
        <paragraph id="3">
            <sentence id="3.1">My Modification:</sentence>
            <sentence id="3.2">-------------------------------------</sentence>
            <sentence id="3.3">package org.hibernate.criterion;</sentence>
            <sentence id="3.4">...</sentence>
            <sentence id="3.5">public class IdentifierProjection extends SimpleProjection {</sentence>
            <sentence id="3.6">...</sentence>
            <sentence id="3.7">public String toSqlString(Criteria criteria, int position, CriteriaQuery criteriaQuery)</sentence>
            <sentence id="3.8">throws HibernateException {</sentence>
            <sentence id="3.9">StringBuffer buf = new StringBuffer();</sentence>
            <sentence id="3.10">String[] cols = criteriaQuery.getIdentifierColumns(criteria);</sentence>
            <sentence id="3.11">for ( int i=0; i&lt;cols.length; i++ ) {</sentence>
            <sentence id="3.12">buf.append( cols[i] )</sentence>
            <sentence id="3.13">.</sentence>
            <sentence id="3.14">append(" as y")</sentence>
            <sentence id="3.15">.</sentence>
            <sentence id="3.16">append(position + i)</sentence>
            <sentence id="3.17">.</sentence>
            <sentence id="3.18">append("_, ");</sentence>
            <sentence id="3.19">}</sentence>
            <sentence id="3.20">buf.delete(buf.length() - 2, buf.length());</sentence>
            <sentence id="3.21">return buf.toString();</sentence>
            <sentence id="3.22">}</sentence>
        </paragraph>
        <paragraph id="4">
            <sentence id="4.1">}</sentence>
        </paragraph>
        <paragraph id="5">
            <sentence id="5.1">The generated SQL (show_sql=true):
select address0_.</sentence>
            <sentence id="5.2">PAR_ID as col_0_0_address0_.</sentence>
            <sentence id="5.3">NUM as col_1_0_, ...</sentence>
        </paragraph>
    </description>
</bug>
