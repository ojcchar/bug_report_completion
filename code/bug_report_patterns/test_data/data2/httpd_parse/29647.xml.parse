<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bug>
    <id>29647</id>
    <title>Strange interaction between "ErrorDocument" directive and "SymlinksIfOwnerMatch" option</title>
    <description>
        <paragraph id="1">
            <sentence id="1.1">This is an odd one, so I'll try to explain it as best as possible.</sentence>
        </paragraph>
        <paragraph id="2">
            <sentence id="2.1">We're running Apache 2.0.49 on linux with Symlinksifownermatch turned on for
public_html directories.</sentence>
            <sentence id="2.2">However, when you try to access a file in someone's
webspace through a symlink, even though the owners match, a 403 forbidden is
thrown with this in the error log:</sentence>
        </paragraph>
        <paragraph id="3">
            <sentence id="3.1">[Thu Jun 17 11:51:55 2004] [error] [client 131.94.133.26] Symbolic link not
allowed: /home/vixen2/flynnj/public_html/link.html</sentence>
        </paragraph>
        <paragraph id="4">
            <sentence id="4.1">Now, if there is an .htaccess file in the public_html directory, containing ONLY
the following:</sentence>
        </paragraph>
        <paragraph id="5">
            <sentence id="5.1">ErrorDocument 404 /~flynnj/404.</sentence>
            <sentence id="5.2">html</sentence>
        </paragraph>
        <paragraph id="6">
            <sentence id="6.1">...suddenly symlinks are followed correctly!</sentence>
            <sentence id="6.2">It even does the owner check; if
the symlink is owned by root, I get a 403 forbidden.</sentence>
        </paragraph>
        <paragraph id="7">
            <sentence id="7.1">Also, the 403 forbidden generated by this seems to behave differently than a
normal 403 forbidden, in that it complains about an "additional 403 forbidden"
accessing the ErrorDocument, which appears just fine when the 403 occurs due to
another reason, such as an unreadable file.</sentence>
            <sentence id="7.2">There are no other ErrorDocument
declarations in the httpd.conf, so I'm not sure where this could be coming from.</sentence>
        </paragraph>
        <paragraph id="8">
            <sentence id="8.1">I can clarify and/or provide more information if required.</sentence>
        </paragraph>
        <paragraph id="9">
            <sentence id="9.1">Virtualhost with the problem:</sentence>
        </paragraph>
        <paragraph id="10">
            <sentence id="10.1">&lt;VirtualHost *&gt;</sentence>
            <sentence id="10.2"> ServerName www.cs.fiu.edu</sentence>
            <sentence id="10.3"> ServerAlias www.cs.fiu.edu</sentence>
            <sentence id="10.4"> ServerAdmin webmaster@cs.fiu.edu</sentence>
            <sentence id="10.5"> DocumentRoot /depot/http/www.cs.fiu.edu/data</sentence>
            <sentence id="10.6"> ErrorLog /depot/http/www.cs.fiu.edu/logs/error_log.apache2</sentence>
            <sentence id="10.7"> ErrorDocument 500 /errors/500.html</sentence>
            <sentence id="10.8"> ErrorDocument 403 /errors/403.html</sentence>
            <sentence id="10.9"> ErrorDocument 404 /errors/404.html</sentence>
            <sentence id="10.10"> ReadmeName README</sentence>
            <sentence id="10.11"> HeaderName HEADER</sentence>
            <sentence id="10.12"> TransferLog /depot/http/www.cs.fiu.edu/logs/access_log.apache2</sentence>
            <sentence id="10.13"> CustomLog /depot/http/www.cs.fiu.edu/logs/referer_log.apache2 referer</sentence>
            <sentence id="10.14"> CustomLog /depot/http/www.cs.fiu.edu/logs/agent_log.apache2 agent</sentence>
            <sentence id="10.15"> CustomLog /depot/http/www.cs.fiu.edu/logs/combined_access_log.apache2 combined</sentence>
            <sentence id="10.16"> ScriptLog /depot/http/www.cs.fiu.edu/logs/cgi.log.apache2</sentence>
            <sentence id="10.17"> ScriptAlias /cgi-bin/ /depot/http/www.cs.fiu.edu/cgi-bin/</sentence>
            <sentence id="10.18"> Alias /icons/ "/depot/http/icons/"</sentence>
            <sentence id="10.19">&lt;/VirtualHost&gt;</sentence>
        </paragraph>
        <paragraph id="11">
            <sentence id="11.1">Directory declaration for home directories:</sentence>
        </paragraph>
        <paragraph id="12">
            <sentence id="12.1">&lt;Directory /home/*&gt;
  AllowOverride AuthConfig FileInfo Limit Indexes
  Options +SymLinksIfOwnerMatch Indexes Includes +ExecCGI
  php_admin_flag safe_mode on
 &lt;/Directory&gt;</sentence>
        </paragraph>
    </description>
</bug>
